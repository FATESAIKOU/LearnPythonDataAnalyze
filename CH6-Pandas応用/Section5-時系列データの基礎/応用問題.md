# Section5: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®åŸºç¤ - å¿œç”¨å•é¡Œ

## å¿œç”¨å•é¡Œ1: EC ã‚µã‚¤ãƒˆã®æ—¥æ¬¡å£²ä¸Šåˆ†æ

### å•é¡Œ

EC ã‚µã‚¤ãƒˆã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

```python
import pandas as pd
import random

random.seed(42)

# 90æ—¥é–“ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
dates = pd.date_range("2024-01-01", periods=90, freq="D")

# é€±æœ«ã¯å£²ä¸ŠãŒé«˜ã„å‚¾å‘
sales = []
for i, date in enumerate(dates):
    base = 10000 + i * 50  # ç·©ã‚„ã‹ãªæˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰
    if date.weekday() >= 5:  # åœŸæ—¥
        base = base * 1.3
    noise = random.randint(-1000, 1000)
    sales.append(int(base + noise))

df = pd.DataFrame({
    "å£²ä¸Š": sales
}, index=dates)
```

#### ã‚¿ã‚¹ã‚¯1: æ—¥ä»˜è¦ç´ ã®è¿½åŠ 

DataFrame ã«ä»¥ä¸‹ã®åˆ—ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š
- ã€Œæœˆã€
- ã€Œæ›œæ—¥ã€ï¼ˆ0=æœˆæ›œã€œ6=æ—¥æ›œï¼‰
- ã€Œæ›œæ—¥åã€ï¼ˆMonday, Tuesday...ï¼‰

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
            å£²ä¸Š   æœˆ  æ›œæ—¥      æ›œæ—¥å
2024-01-01  9910   1     0      Monday
2024-01-02  11016  1     1     Tuesday
...
```

#### ã‚¿ã‚¹ã‚¯2: æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ

æœˆã”ã¨ã®å£²ä¸Šã‚’é›†è¨ˆã—ã€åˆè¨ˆãƒ»å¹³å‡ãƒ»å–å¼•æ—¥æ•°ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
               sum       mean  count
2024-01-31  390xxx  12xxx.xx     31
2024-02-29  460xxx  15xxx.xx     29
2024-03-31  540xxx  18xxx.xx     30
```

#### ã‚¿ã‚¹ã‚¯3: æ›œæ—¥åˆ¥å£²ä¸Šåˆ†æ

æ›œæ—¥ã”ã¨ã®å¹³å‡å£²ä¸Šã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
ã€æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Šã€‘

å£²ä¸Š
  ^
18000â”‚         â—    â—
16000â”‚                     
14000â”‚ â—  â—  â—  â—  â—
12000â”‚
10000â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ›œæ—¥
      æœˆ  ç«  æ°´  æœ¨  é‡‘  åœŸ  æ—¥

æœˆæ›œæ—¥: 13xxxå††
ç«æ›œæ—¥: 13xxxå††
...
åœŸæ›œæ—¥: 17xxxå††
æ—¥æ›œæ—¥: 18xxxå††
```

#### ã‚¿ã‚¹ã‚¯4: 7æ—¥ç§»å‹•å¹³å‡

7æ—¥ç§»å‹•å¹³å‡ã‚’è¨ˆç®—ã—ã€ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
ã€å£²ä¸Šã¨7æ—¥ç§»å‹•å¹³å‡ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‘

å£²ä¸Š
  ^
20000â”‚                              ãƒã‚¤ã‚ºã®ã‚ã‚‹å®Ÿãƒ‡ãƒ¼ã‚¿
18000â”‚              /\/\/\
16000â”‚         /\/\/      \/\/\
14000â”‚    /\/\/               â”€â”€ ãªã‚ã‚‰ã‹ãªç§»å‹•å¹³å‡ç·š
12000â”‚/\/
10000â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¥ä»˜
      1æœˆ        2æœˆ        3æœˆ

            å£²ä¸Š  7æ—¥ç§»å‹•å¹³å‡
2024-01-07  11xx   10xxx.xx
2024-01-08  12xx   10xxx.xx
...
```

<details>
<summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>

**åŸºæœ¬è§£æ³•:**
```python
import pandas as pd
import random

random.seed(42)

dates = pd.date_range("2024-01-01", periods=90, freq="D")
sales = []
for i, date in enumerate(dates):
    base = 10000 + i * 50
    if date.weekday() >= 5:
        base = base * 1.3
    noise = random.randint(-1000, 1000)
    sales.append(int(base + noise))

df = pd.DataFrame({"å£²ä¸Š": sales}, index=dates)

# ã‚¿ã‚¹ã‚¯1: æ—¥ä»˜è¦ç´ ã®è¿½åŠ ï¼ˆæ‰‹å‹•ï¼‰
months = []
weekdays = []
weekday_names_list = []
weekday_names = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]

for date in df.index:
    months.append(date.month)
    weekdays.append(date.weekday())
    weekday_names_list.append(weekday_names[date.weekday()])

df["æœˆ"] = months
df["æ›œæ—¥"] = weekdays
df["æ›œæ—¥å"] = weekday_names_list

print("=== ã‚¿ã‚¹ã‚¯1: æ—¥ä»˜è¦ç´ ã®è¿½åŠ  ===")
print(df.head())

# ã‚¿ã‚¹ã‚¯2: æœˆæ¬¡é›†è¨ˆï¼ˆæ‰‹å‹•ï¼‰
print("\n=== ã‚¿ã‚¹ã‚¯2: æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ ===")
monthly_stats = {}
for date, row in df.iterrows():
    month_key = f"{date.year}-{date.month:02d}"
    if month_key not in monthly_stats:
        monthly_stats[month_key] = {"sum": 0, "count": 0}
    monthly_stats[month_key]["sum"] += row["å£²ä¸Š"]
    monthly_stats[month_key]["count"] += 1

for month, stats in monthly_stats.items():
    mean = stats["sum"] / stats["count"]
    print(f"{month}: åˆè¨ˆ={stats['sum']}, å¹³å‡={mean:.2f}, æ—¥æ•°={stats['count']}")

# ã‚¿ã‚¹ã‚¯3: æ›œæ—¥åˆ¥å¹³å‡ï¼ˆæ‰‹å‹•ï¼‰
print("\n=== ã‚¿ã‚¹ã‚¯3: æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š ===")
weekday_totals = {i: 0 for i in range(7)}
weekday_counts = {i: 0 for i in range(7)}

for date, row in df.iterrows():
    wd = date.weekday()
    weekday_totals[wd] += row["å£²ä¸Š"]
    weekday_counts[wd] += 1

weekday_jp = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
for wd in range(7):
    avg = weekday_totals[wd] / weekday_counts[wd]
    print(f"{weekday_jp[wd]}æ›œæ—¥: {avg:.0f}å††")

# ã‚¿ã‚¹ã‚¯4: 7æ—¥ç§»å‹•å¹³å‡ï¼ˆæ‰‹å‹•ï¼‰
print("\n=== ã‚¿ã‚¹ã‚¯4: 7æ—¥ç§»å‹•å¹³å‡ ===")
moving_avg = []
for i in range(len(df)):
    if i < 6:
        moving_avg.append(float('nan'))
    else:
        total = 0
        for j in range(7):
            total += df["å£²ä¸Š"].iloc[i - j]
        moving_avg.append(total / 7)

df["7æ—¥ç§»å‹•å¹³å‡"] = moving_avg
print(df.iloc[5:15][["å£²ä¸Š", "7æ—¥ç§»å‹•å¹³å‡"]])
```

**ç™ºå±•è§£æ³•ï¼ˆPandas é–¢æ•°ï¼‰:**
```python
import pandas as pd
import random

random.seed(42)

dates = pd.date_range("2024-01-01", periods=90, freq="D")
sales = []
for i, date in enumerate(dates):
    base = 10000 + i * 50
    if date.weekday() >= 5:
        base = base * 1.3
    noise = random.randint(-1000, 1000)
    sales.append(int(base + noise))

df = pd.DataFrame({"å£²ä¸Š": sales}, index=dates)

# ã‚¿ã‚¹ã‚¯1: æ—¥ä»˜è¦ç´ ã®è¿½åŠ 
print("=== ã‚¿ã‚¹ã‚¯1: æ—¥ä»˜è¦ç´ ã®è¿½åŠ  ===")
df["æœˆ"] = df.index.month
df["æ›œæ—¥"] = df.index.weekday
df["æ›œæ—¥å"] = df.index.day_name()
print(df.head())

# ã‚¿ã‚¹ã‚¯2: æœˆæ¬¡é›†è¨ˆ
print("\n=== ã‚¿ã‚¹ã‚¯2: æœˆæ¬¡å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ ===")
monthly = df[["å£²ä¸Š"]].resample("ME").agg(["sum", "mean", "count"])
print(monthly)

# ã‚¿ã‚¹ã‚¯3: æ›œæ—¥åˆ¥å¹³å‡
print("\n=== ã‚¿ã‚¹ã‚¯3: æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š ===")
weekday_avg = df.groupby("æ›œæ—¥")["å£²ä¸Š"].mean()
weekday_jp = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
for wd, avg in weekday_avg.items():
    print(f"{weekday_jp[wd]}æ›œæ—¥: {avg:.0f}å††")

# ã‚¿ã‚¹ã‚¯4: 7æ—¥ç§»å‹•å¹³å‡
print("\n=== ã‚¿ã‚¹ã‚¯4: 7æ—¥ç§»å‹•å¹³å‡ ===")
df["7æ—¥ç§»å‹•å¹³å‡"] = df["å£²ä¸Š"].rolling(7).mean()
print(df.iloc[5:15][["å£²ä¸Š", "7æ—¥ç§»å‹•å¹³å‡"]])
```

</details>

---

## å¿œç”¨å•é¡Œ2: æ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ

### å•é¡Œ

æ¨¡æ“¬çš„ãªæ ªä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

```python
import pandas as pd
import random

random.seed(123)

# 250å–¶æ¥­æ—¥ã®æ ªä¾¡ãƒ‡ãƒ¼ã‚¿
dates = pd.date_range("2024-01-01", periods=250, freq="B")  # B = å–¶æ¥­æ—¥
price = 1000  # åˆæœŸæ ªä¾¡
prices = []

for i in range(250):
    change = random.uniform(-0.03, 0.035)  # -3% ã€œ +3.5% ã®å¤‰å‹•
    price = price * (1 + change)
    prices.append(round(price, 0))

df = pd.DataFrame({
    "çµ‚å€¤": prices
}, index=dates)
```

#### ã‚¿ã‚¹ã‚¯1: æœˆæ¬¡ã‚µãƒãƒªãƒ¼

æœˆã”ã¨ã«ä»¥ä¸‹ã‚’é›†è¨ˆã—ã¦ãã ã•ã„ï¼š
- æœˆåˆå€¤ï¼ˆfirstï¼‰
- æœˆæœ«å€¤ï¼ˆlastï¼‰
- æœˆé–“æœ€é«˜å€¤ï¼ˆmaxï¼‰
- æœˆé–“æœ€å®‰å€¤ï¼ˆminï¼‰

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
              first    last     max     min
2024-01-31   1000.0  1xxx.x  1xxx.x   9xx.x
2024-02-29   1xxx.x  1xxx.x  1xxx.x  1xxx.x
...
```

#### ã‚¿ã‚¹ã‚¯2: ç§»å‹•å¹³å‡ç·š

5æ—¥ç§»å‹•å¹³å‡ã¨25æ—¥ç§»å‹•å¹³å‡ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
ã€æ ªä¾¡ã¨ç§»å‹•å¹³å‡ç·šã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‘

æ ªä¾¡
  ^
1400â”‚
1300â”‚                  /\
1200â”‚              /\/    \
1100â”‚         /\/          \___  â”â”â” 5æ—¥MAï¼ˆçŸ­æœŸï¼‰
1000â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”â”â” 25æ—¥MAï¼ˆé•·æœŸï¼‰
 900â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¥ä»˜

            çµ‚å€¤   5æ—¥MA    25æ—¥MA
2024-01-08  1xxx  1xxx.xx      NaN
...
2024-02-05  1xxx  1xxx.xx  1xxx.xx
```

#### ã‚¿ã‚¹ã‚¯3: å››åŠæœŸåˆ¥ãƒªã‚¿ãƒ¼ãƒ³

å››åŠæœŸã”ã¨ã®æ ªä¾¡å¤‰å‹•ç‡ï¼ˆ%ï¼‰ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚
å¤‰å‹•ç‡ = (æœŸæœ«å€¤ - æœŸåˆå€¤) / æœŸåˆå€¤ * 100

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
2024å¹´ Q1: +xx.x%
2024å¹´ Q2: +xx.x%
...
```

<details>
<summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>

**åŸºæœ¬è§£æ³•:**
```python
import pandas as pd
import random

random.seed(123)

dates = pd.date_range("2024-01-01", periods=250, freq="B")
price = 1000
prices = []
for i in range(250):
    change = random.uniform(-0.03, 0.035)
    price = price * (1 + change)
    prices.append(round(price, 0))

df = pd.DataFrame({"çµ‚å€¤": prices}, index=dates)

print("=== ã‚¿ã‚¹ã‚¯1: æœˆæ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆæ‰‹å‹•ï¼‰===")
monthly_data = {}
for date, row in df.iterrows():
    month_key = f"{date.year}-{date.month:02d}"
    if month_key not in monthly_data:
        monthly_data[month_key] = {
            "first": row["çµ‚å€¤"],
            "last": row["çµ‚å€¤"],
            "max": row["çµ‚å€¤"],
            "min": row["çµ‚å€¤"]
        }
    else:
        monthly_data[month_key]["last"] = row["çµ‚å€¤"]
        if row["çµ‚å€¤"] > monthly_data[month_key]["max"]:
            monthly_data[month_key]["max"] = row["çµ‚å€¤"]
        if row["çµ‚å€¤"] < monthly_data[month_key]["min"]:
            monthly_data[month_key]["min"] = row["çµ‚å€¤"]

for month, stats in list(monthly_data.items())[:3]:
    print(f"{month}: åˆå€¤={stats['first']}, çµ‚å€¤={stats['last']}, "
          f"é«˜å€¤={stats['max']}, å®‰å€¤={stats['min']}")

print("\n=== ã‚¿ã‚¹ã‚¯2: ç§»å‹•å¹³å‡ï¼ˆæ‰‹å‹•ï¼‰===")
ma5 = []
ma25 = []
for i in range(len(df)):
    # 5æ—¥ç§»å‹•å¹³å‡
    if i < 4:
        ma5.append(float('nan'))
    else:
        total = 0
        for j in range(5):
            total += df["çµ‚å€¤"].iloc[i - j]
        ma5.append(total / 5)
    
    # 25æ—¥ç§»å‹•å¹³å‡
    if i < 24:
        ma25.append(float('nan'))
    else:
        total = 0
        for j in range(25):
            total += df["çµ‚å€¤"].iloc[i - j]
        ma25.append(total / 25)

df["5æ—¥MA"] = ma5
df["25æ—¥MA"] = ma25
print(df.iloc[23:30][["çµ‚å€¤", "5æ—¥MA", "25æ—¥MA"]])

print("\n=== ã‚¿ã‚¹ã‚¯3: å››åŠæœŸåˆ¥ãƒªã‚¿ãƒ¼ãƒ³ï¼ˆæ‰‹å‹•ï¼‰===")
quarterly_data = {}
for date, row in df.iterrows():
    q_key = f"{date.year}-Q{(date.month - 1) // 3 + 1}"
    if q_key not in quarterly_data:
        quarterly_data[q_key] = {"first": row["çµ‚å€¤"], "last": row["çµ‚å€¤"]}
    else:
        quarterly_data[q_key]["last"] = row["çµ‚å€¤"]

for q, data in quarterly_data.items():
    ret = (data["last"] - data["first"]) / data["first"] * 100
    print(f"{q}: {ret:+.1f}%")
```

**ç™ºå±•è§£æ³•ï¼ˆPandas é–¢æ•°ï¼‰:**
```python
import pandas as pd
import random

random.seed(123)

dates = pd.date_range("2024-01-01", periods=250, freq="B")
price = 1000
prices = []
for i in range(250):
    change = random.uniform(-0.03, 0.035)
    price = price * (1 + change)
    prices.append(round(price, 0))

df = pd.DataFrame({"çµ‚å€¤": prices}, index=dates)

# ã‚¿ã‚¹ã‚¯1: æœˆæ¬¡ã‚µãƒãƒªãƒ¼
print("=== ã‚¿ã‚¹ã‚¯1: æœˆæ¬¡ã‚µãƒãƒªãƒ¼ ===")
monthly = df.resample("ME").agg(["first", "last", "max", "min"])
print(monthly.head())

# ã‚¿ã‚¹ã‚¯2: ç§»å‹•å¹³å‡
print("\n=== ã‚¿ã‚¹ã‚¯2: ç§»å‹•å¹³å‡ç·š ===")
df["5æ—¥MA"] = df["çµ‚å€¤"].rolling(5).mean()
df["25æ—¥MA"] = df["çµ‚å€¤"].rolling(25).mean()
print(df.iloc[23:30])

# ã‚¿ã‚¹ã‚¯3: å››åŠæœŸåˆ¥ãƒªã‚¿ãƒ¼ãƒ³
print("\n=== ã‚¿ã‚¹ã‚¯3: å››åŠæœŸåˆ¥ãƒªã‚¿ãƒ¼ãƒ³ ===")
quarterly = df.resample("QE").agg(["first", "last"])
quarterly.columns = ["æœŸåˆ", "æœŸæœ«"]
quarterly["ãƒªã‚¿ãƒ¼ãƒ³(%)"] = (quarterly["æœŸæœ«"] - quarterly["æœŸåˆ"]) / quarterly["æœŸåˆ"] * 100
print(quarterly)

for date, row in quarterly.iterrows():
    q = (date.month - 1) // 3 + 1
    print(f"{date.year}å¹´ Q{q}: {row['ãƒªã‚¿ãƒ¼ãƒ³(%)']:+.1f}%")
```

</details>

---

## å¿œç”¨å•é¡Œ3: ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®æ™‚é–“å¸¯åˆ†æ

### å•é¡Œ

Web ã‚µã‚¤ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

```python
import pandas as pd
import random

random.seed(456)

# 1é€±é–“åˆ†ã®æ™‚é–“åˆ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ‡ãƒ¼ã‚¿
dates = pd.date_range("2024-01-01", periods=168, freq="h")  # 168æ™‚é–“ = 7æ—¥

accesses = []
for date in dates:
    hour = date.hour
    weekday = date.weekday()
    
    # æ™‚é–“å¸¯åˆ¥ã®åŸºæœ¬ã‚¢ã‚¯ã‚»ã‚¹æ•°
    if 0 <= hour < 6:
        base = 50
    elif 6 <= hour < 9:
        base = 150
    elif 9 <= hour < 12:
        base = 300
    elif 12 <= hour < 14:
        base = 400
    elif 14 <= hour < 18:
        base = 350
    elif 18 <= hour < 22:
        base = 500
    else:
        base = 200
    
    # é€±æœ«ã¯ 1.2 å€
    if weekday >= 5:
        base = int(base * 1.2)
    
    noise = random.randint(-30, 30)
    accesses.append(base + noise)

df = pd.DataFrame({
    "ã‚¢ã‚¯ã‚»ã‚¹æ•°": accesses
}, index=dates)
```

#### ã‚¿ã‚¹ã‚¯1: æ™‚é–“å¸¯åˆ¥å¹³å‡ã‚¢ã‚¯ã‚»ã‚¹

0-23æ™‚ã®æ™‚é–“å¸¯åˆ¥å¹³å‡ã‚¢ã‚¯ã‚»ã‚¹æ•°ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
ã€æ™‚é–“å¸¯åˆ¥ã‚¢ã‚¯ã‚»ã‚¹æ•°ã€‘

ã‚¢ã‚¯ã‚»ã‚¹
   ^
500â”‚                    â—â—â—â—
400â”‚       â—â—  â—â—â—â—
300â”‚    â—â—â—
200â”‚ â—â—              â—â—â—
100â”‚
 50â”‚â—â—â—â—â—
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ™‚é–“
    0  3  6  9  12 15 18 21 24

 0æ™‚: xxx
 1æ™‚: xxx
...
23æ™‚: xxx
```

#### ã‚¿ã‚¹ã‚¯2: æ›œæ—¥Ã—æ™‚é–“å¸¯ã®ãƒ”ãƒ¼ã‚¯åˆ†æ

æ›œæ—¥ã¨æ™‚é–“å¸¯ã®çµ„ã¿åˆã‚ã›ã§ã€æœ€ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ãŒå¤šã„çµ„ã¿åˆã‚ã› TOP5 ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
ã€ã‚¢ã‚¯ã‚»ã‚¹æ•° TOP5ã€‘
1ä½: åœŸæ›œæ—¥ 20æ™‚ - xxx ã‚¢ã‚¯ã‚»ã‚¹
2ä½: æ—¥æ›œæ—¥ 19æ™‚ - xxx ã‚¢ã‚¯ã‚»ã‚¹
...
```

#### ã‚¿ã‚¹ã‚¯3: æ™‚é–“å¸¯åˆ¥ã®ç´¯è¨ˆ

å„æ—¥ã®æ™‚é–“å¸¯åˆ¥ç´¯è¨ˆã‚¢ã‚¯ã‚»ã‚¹æ•°ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ï¼ˆ1æ—¥ã”ã¨ã«0ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰ã€‚

**æœŸå¾…ã™ã‚‹å½¢å¼:**
```
            ã‚¢ã‚¯ã‚»ã‚¹æ•°  1æ—¥ç´¯è¨ˆ
2024-01-01 00:00:00     xx       xx
2024-01-01 01:00:00     xx      xxx
2024-01-01 02:00:00     xx      xxx
...
2024-01-01 23:00:00    xxx     xxxx  â† 1æ—¥ã®åˆè¨ˆ
2024-01-02 00:00:00     xx       xx  â† ç¿Œæ—¥ã¯ãƒªã‚»ãƒƒãƒˆ
```

<details>
<summary>è§£ç­”ä¾‹ã‚’è¦‹ã‚‹</summary>

**åŸºæœ¬è§£æ³•:**
```python
import pandas as pd
import random

random.seed(456)

dates = pd.date_range("2024-01-01", periods=168, freq="h")
accesses = []
for date in dates:
    hour = date.hour
    weekday = date.weekday()
    if 0 <= hour < 6:
        base = 50
    elif 6 <= hour < 9:
        base = 150
    elif 9 <= hour < 12:
        base = 300
    elif 12 <= hour < 14:
        base = 400
    elif 14 <= hour < 18:
        base = 350
    elif 18 <= hour < 22:
        base = 500
    else:
        base = 200
    if weekday >= 5:
        base = int(base * 1.2)
    noise = random.randint(-30, 30)
    accesses.append(base + noise)

df = pd.DataFrame({"ã‚¢ã‚¯ã‚»ã‚¹æ•°": accesses}, index=dates)

print("=== ã‚¿ã‚¹ã‚¯1: æ™‚é–“å¸¯åˆ¥å¹³å‡ï¼ˆæ‰‹å‹•ï¼‰===")
hourly_totals = {h: 0 for h in range(24)}
hourly_counts = {h: 0 for h in range(24)}

for date, row in df.iterrows():
    hour = date.hour
    hourly_totals[hour] += row["ã‚¢ã‚¯ã‚»ã‚¹æ•°"]
    hourly_counts[hour] += 1

for h in range(24):
    avg = hourly_totals[h] / hourly_counts[h]
    print(f"{h:2d}æ™‚: {avg:.0f}")

print("\n=== ã‚¿ã‚¹ã‚¯2: æ›œæ—¥Ã—æ™‚é–“å¸¯ TOP5ï¼ˆæ‰‹å‹•ï¼‰===")
combo_totals = {}
combo_counts = {}
weekday_names = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]

for date, row in df.iterrows():
    key = (date.weekday(), date.hour)
    if key not in combo_totals:
        combo_totals[key] = 0
        combo_counts[key] = 0
    combo_totals[key] += row["ã‚¢ã‚¯ã‚»ã‚¹æ•°"]
    combo_counts[key] += 1

combo_avgs = {}
for key in combo_totals:
    combo_avgs[key] = combo_totals[key] / combo_counts[key]

# TOP5 ã‚’æ‰‹å‹•ã§ã‚½ãƒ¼ãƒˆ
sorted_combos = sorted(combo_avgs.items(), key=lambda x: x[1], reverse=True)

print("ã€ã‚¢ã‚¯ã‚»ã‚¹æ•° TOP5ã€‘")
for i, ((wd, hour), avg) in enumerate(sorted_combos[:5]):
    print(f"{i+1}ä½: {weekday_names[wd]}æ›œæ—¥ {hour}æ™‚ - {avg:.0f} ã‚¢ã‚¯ã‚»ã‚¹")

print("\n=== ã‚¿ã‚¹ã‚¯3: 1æ—¥ç´¯è¨ˆï¼ˆæ‰‹å‹•ï¼‰===")
df["æ—¥"] = [d.date() for d in df.index]
df["1æ—¥ç´¯è¨ˆ"] = 0

current_date = None
cumsum = 0
cumulative = []

for date, row in df.iterrows():
    if date.date() != current_date:
        current_date = date.date()
        cumsum = 0
    cumsum += row["ã‚¢ã‚¯ã‚»ã‚¹æ•°"]
    cumulative.append(cumsum)

df["1æ—¥ç´¯è¨ˆ"] = cumulative
print(df.iloc[:26][["ã‚¢ã‚¯ã‚»ã‚¹æ•°", "1æ—¥ç´¯è¨ˆ"]])
```

**ç™ºå±•è§£æ³•ï¼ˆPandas é–¢æ•°ï¼‰:**
```python
import pandas as pd
import random

random.seed(456)

dates = pd.date_range("2024-01-01", periods=168, freq="h")
accesses = []
for date in dates:
    hour = date.hour
    weekday = date.weekday()
    if 0 <= hour < 6:
        base = 50
    elif 6 <= hour < 9:
        base = 150
    elif 9 <= hour < 12:
        base = 300
    elif 12 <= hour < 14:
        base = 400
    elif 14 <= hour < 18:
        base = 350
    elif 18 <= hour < 22:
        base = 500
    else:
        base = 200
    if weekday >= 5:
        base = int(base * 1.2)
    noise = random.randint(-30, 30)
    accesses.append(base + noise)

df = pd.DataFrame({"ã‚¢ã‚¯ã‚»ã‚¹æ•°": accesses}, index=dates)

# è¦ç´ ã®æŠ½å‡º
df["æ™‚"] = df.index.hour
df["æ›œæ—¥"] = df.index.weekday
df["æ—¥ä»˜"] = df.index.date

# ã‚¿ã‚¹ã‚¯1: æ™‚é–“å¸¯åˆ¥å¹³å‡
print("=== ã‚¿ã‚¹ã‚¯1: æ™‚é–“å¸¯åˆ¥å¹³å‡ã‚¢ã‚¯ã‚»ã‚¹ ===")
hourly_avg = df.groupby("æ™‚")["ã‚¢ã‚¯ã‚»ã‚¹æ•°"].mean()
for hour, avg in hourly_avg.items():
    print(f"{hour:2d}æ™‚: {avg:.0f}")

# ã‚¿ã‚¹ã‚¯2: æ›œæ—¥Ã—æ™‚é–“å¸¯ TOP5
print("\n=== ã‚¿ã‚¹ã‚¯2: æ›œæ—¥Ã—æ™‚é–“å¸¯ TOP5 ===")
combo = df.groupby(["æ›œæ—¥", "æ™‚"])["ã‚¢ã‚¯ã‚»ã‚¹æ•°"].mean()
top5 = combo.sort_values(ascending=False).head()

weekday_names = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
print("ã€ã‚¢ã‚¯ã‚»ã‚¹æ•° TOP5ã€‘")
for i, ((wd, hour), avg) in enumerate(top5.items()):
    print(f"{i+1}ä½: {weekday_names[wd]}æ›œæ—¥ {hour}æ™‚ - {avg:.0f} ã‚¢ã‚¯ã‚»ã‚¹")

# ã‚¿ã‚¹ã‚¯3: 1æ—¥ç´¯è¨ˆ
print("\n=== ã‚¿ã‚¹ã‚¯3: 1æ—¥ç´¯è¨ˆ ===")
df["1æ—¥ç´¯è¨ˆ"] = df.groupby("æ—¥ä»˜")["ã‚¢ã‚¯ã‚»ã‚¹æ•°"].cumsum()
print(df.iloc[:26][["ã‚¢ã‚¯ã‚»ã‚¹æ•°", "1æ—¥ç´¯è¨ˆ"]])
```

</details>

---

## ğŸ‰ CH6 å®Œäº†ï¼

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼Pandas å¿œç”¨ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¾ã—ãŸï¼

**CH6 ã§å­¦ã‚“ã ã“ã¨:**
- Section1: ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆæ¬ æå€¤ã€é‡è¤‡å‰Šé™¤ï¼‰
- Section2: ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›ã¨åŠ å·¥ï¼ˆapplyã€renameï¼‰
- Section3: ãƒ‡ãƒ¼ã‚¿ã®çµåˆï¼ˆconcatã€mergeã€joinï¼‰
- Section4: ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã¨é›†è¨ˆï¼ˆgroupbyã€pivot_tableï¼‰
- Section5: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ï¼ˆdatetimeã€resampleã€rollingï¼‰

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:**
CH7ã€ŒMatplotlibå…¥é–€ã€ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã—ã¾ã—ã‚‡ã†ï¼
