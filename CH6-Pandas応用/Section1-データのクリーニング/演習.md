# Section1: データのクリーニング - 演習

## 🎯 この演習の目的

欠損値の処理、重複削除、データ型変換、文字列整形の基本操作を
実際に手を動かして習得しましょう。

---

## 📝 演習1: 欠損値の確認

### 課題

以下のデータで欠損値を確認してください。

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "商品名": ["りんご", "みかん", None, "バナナ", "ぶどう"],
    "価格": [100, np.nan, 150, 80, np.nan],
    "在庫": [50, 30, np.nan, 100, 20]
})

print("=== データ ===")
print(df)
```

1. 各セルが欠損値かどうかを確認
2. 列ごとの欠損値の数をカウント
3. 全体の欠損値の数をカウント

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "商品名": ["りんご", "みかん", None, "バナナ", "ぶどう"],
    "価格": [100, np.nan, 150, 80, np.nan],
    "在庫": [50, 30, np.nan, 100, 20]
})

print("=== データ ===")
print(df)
print()

# 1. 各セルが欠損値かどうかを確認
print("=== 1. isnull() で各セルを確認 ===")
print(df.isnull())
print()

# 2. 列ごとの欠損値の数をカウント
print("=== 2. 列ごとの欠損値数 ===")
print(df.isnull().sum())
print()

# 3. 全体の欠損値の数をカウント
total_null = df.isnull().sum().sum()
print(f"=== 3. 全体の欠損値数: {total_null} ===")
```

**実行結果:**
```
=== データ ===
   商品名     価格    在庫
0  りんご  100.0   50.0
1  みかん    NaN   30.0
2    None  150.0    NaN
3  バナナ   80.0  100.0
4  ぶどう    NaN   20.0

=== 1. isnull() で各セルを確認 ===
    商品名   価格    在庫
0  False  False  False
1  False   True  False
2   True  False   True
3  False  False  False
4  False   True  False

=== 2. 列ごとの欠損値数 ===
商品名    1
価格      2
在庫      1
dtype: int64

=== 3. 全体の欠損値数: 4 ===
```

</details>

---

## 📝 演習2: 欠損値の削除（dropna）

### 課題

以下のデータから欠損値を削除してください。

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "名前": ["田中", "佐藤", None, "高橋", "伊藤"],
    "部署": ["営業", "開発", "営業", np.nan, "人事"],
    "年齢": [25, np.nan, 30, 35, 28]
})

print("=== 元のデータ ===")
print(df)
```

1. すべての欠損値を含む行を削除
2. 「名前」列に欠損値がある行のみを削除
3. すべての値が欠損の行のみを削除（how="all"）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "名前": ["田中", "佐藤", None, "高橋", "伊藤"],
    "部署": ["営業", "開発", "営業", np.nan, "人事"],
    "年齢": [25, np.nan, 30, 35, 28]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. すべての欠損値を含む行を削除
df_all_dropped = df.dropna()
print("=== 1. すべての欠損値を含む行を削除 ===")
print(df_all_dropped)
print()

# 2. 「名前」列に欠損値がある行のみを削除
df_name_dropped = df.dropna(subset=["名前"])
print("=== 2. 名前列の欠損のみ削除 ===")
print(df_name_dropped)
print()

# 3. すべての値が欠損の行のみを削除
# まず、すべてが欠損の行を追加したデータを作成
df_with_all_nan = pd.DataFrame({
    "名前": ["田中", "佐藤", None, np.nan],
    "部署": ["営業", "開発", None, np.nan],
    "年齢": [25, np.nan, None, np.nan]
})
print("=== 3. すべてが欠損の行のみ削除 ===")
print("削除前:")
print(df_with_all_nan)
df_how_all = df_with_all_nan.dropna(how="all")
print("\n削除後:")
print(df_how_all)
```

**実行結果:**
```
=== 元のデータ ===
    名前    部署    年齢
0   田中    営業   25.0
1   佐藤    開発    NaN
2   None    営業   30.0
3   高橋    NaN   35.0
4   伊藤    人事   28.0

=== 1. すべての欠損値を含む行を削除 ===
   名前  部署    年齢
0  田中  営業   25.0
4  伊藤  人事   28.0

=== 2. 名前列の欠損のみ削除 ===
   名前    部署    年齢
0  田中    営業   25.0
1  佐藤    開発    NaN
3  高橋    NaN   35.0
4  伊藤    人事   28.0

=== 3. すべてが欠損の行のみ削除 ===
削除前:
   名前    部署    年齢
0  田中    営業   25.0
1  佐藤    開発    NaN
2  None  None    NaN
3  NaN   NaN    NaN

削除後:
   名前    部署    年齢
0  田中    営業   25.0
1  佐藤    開発    NaN
2  None  None    NaN
```

</details>

---

## 📝 演習3: 欠損値の補完（fillna）

### 課題

以下のデータの欠損値を補完してください。

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "商品": ["A", "B", "C", "D", "E"],
    "売上": [1000, np.nan, 1500, np.nan, 2000],
    "評価": [4.5, 3.8, np.nan, 4.2, np.nan]
})

print("=== 元のデータ ===")
print(df)
```

1. すべての欠損値を 0 で補完
2. 売上の欠損値を平均値で補完
3. 売上は 0 、評価は 3.0 で補完（列ごとに異なる値）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    "商品": ["A", "B", "C", "D", "E"],
    "売上": [1000, np.nan, 1500, np.nan, 2000],
    "評価": [4.5, 3.8, np.nan, 4.2, np.nan]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. すべての欠損値を 0 で補完
df_zero = df.fillna(0)
print("=== 1. 0 で補完 ===")
print(df_zero)
print()

# 2. 売上の欠損値を平均値で補完
df_copy = df.copy()
sales_mean = df_copy["売上"].mean()
print(f"売上の平均値: {sales_mean}")
df_copy["売上"] = df_copy["売上"].fillna(sales_mean)
print("=== 2. 売上を平均値で補完 ===")
print(df_copy)
print()

# 3. 売上は 0 、評価は 3.0 で補完
df_custom = df.fillna({"売上": 0, "評価": 3.0})
print("=== 3. 列ごとに異なる値で補完 ===")
print(df_custom)
```

**実行結果:**
```
=== 元のデータ ===
  商品      売上   評価
0    A  1000.0  4.5
1    B     NaN  3.8
2    C  1500.0  NaN
3    D     NaN  4.2
4    E  2000.0  NaN

=== 1. 0 で補完 ===
  商品      売上   評価
0    A  1000.0  4.5
1    B     0.0  3.8
2    C  1500.0  0.0
3    D     0.0  4.2
4    E  2000.0  0.0

売上の平均値: 1500.0
=== 2. 売上を平均値で補完 ===
  商品      売上   評価
0    A  1000.0  4.5
1    B  1500.0  3.8
2    C  1500.0  NaN
3    D  1500.0  4.2
4    E  2000.0  NaN

=== 3. 列ごとに異なる値で補完 ===
  商品      売上   評価
0    A  1000.0  4.5
1    B     0.0  3.8
2    C  1500.0  3.0
3    D     0.0  4.2
4    E  2000.0  3.0
```

</details>

---

## 📝 演習4: 重複データの処理

### 課題

以下のデータで重複を確認・削除してください。

```python
import pandas as pd

df = pd.DataFrame({
    "顧客ID": ["C001", "C002", "C001", "C003", "C002", "C004"],
    "名前": ["田中", "佐藤", "田中", "鈴木", "佐藤", "高橋"],
    "購入金額": [1000, 2000, 1000, 1500, 2000, 3000]
})

print("=== 元のデータ ===")
print(df)
```

1. 重複している行を確認
2. 重複行の数をカウント
3. 重複を削除
4. 顧客ID のみで重複を判定して削除

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "顧客ID": ["C001", "C002", "C001", "C003", "C002", "C004"],
    "名前": ["田中", "佐藤", "田中", "鈴木", "佐藤", "高橋"],
    "購入金額": [1000, 2000, 1000, 1500, 2000, 3000]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 重複している行を確認
print("=== 1. duplicated() で重複を確認 ===")
print(df.duplicated())
print()

# 重複している行を表示
print("=== 重複している行のデータ ===")
print(df[df.duplicated()])
print()

# 2. 重複行の数をカウント
dup_count = df.duplicated().sum()
print(f"=== 2. 重複行数: {dup_count} ===")
print()

# 3. 重複を削除
df_unique = df.drop_duplicates()
print("=== 3. 重複削除後 ===")
print(df_unique)
print()

# 4. 顧客ID のみで重複を判定して削除
df_id_unique = df.drop_duplicates(subset=["顧客ID"])
print("=== 4. 顧客IDで重複削除（最初の行を残す）===")
print(df_id_unique)
```

**実行結果:**
```
=== 元のデータ ===
  顧客ID  名前  購入金額
0   C001  田中     1000
1   C002  佐藤     2000
2   C001  田中     1000
3   C003  鈴木     1500
4   C002  佐藤     2000
5   C004  高橋     3000

=== 1. duplicated() で重複を確認 ===
0    False
1    False
2     True
3    False
4     True
5    False
dtype: bool

=== 重複している行のデータ ===
  顧客ID  名前  購入金額
2   C001  田中     1000
4   C002  佐藤     2000

=== 2. 重複行数: 2 ===

=== 3. 重複削除後 ===
  顧客ID  名前  購入金額
0   C001  田中     1000
1   C002  佐藤     2000
3   C003  鈴木     1500
5   C004  高橋     3000

=== 4. 顧客IDで重複削除（最初の行を残す）===
  顧客ID  名前  購入金額
0   C001  田中     1000
1   C002  佐藤     2000
3   C003  鈴木     1500
5   C004  高橋     3000
```

</details>

---

## 📝 演習5: データ型の変換

### 課題

以下のデータのデータ型を変換してください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品コード": ["001", "002", "003"],
    "価格": ["1000", "2000", "1500"],
    "割引率": ["0.1", "0.2", "0.15"],
    "在庫あり": ["True", "False", "True"]
})

print("=== 元のデータ ===")
print(df)
print("\n=== データ型 ===")
print(df.dtypes)
```

1. 「価格」を整数（int）に変換
2. 「割引率」を小数（float）に変換
3. 「在庫あり」を真偽値（bool）に変換
4. 変換後に「売上」列（価格 × (1 - 割引率)）を計算

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品コード": ["001", "002", "003"],
    "価格": ["1000", "2000", "1500"],
    "割引率": ["0.1", "0.2", "0.15"],
    "在庫あり": ["True", "False", "True"]
})

print("=== 元のデータ ===")
print(df)
print("\n=== 元のデータ型 ===")
print(df.dtypes)
print()

# 1. 「価格」を整数（int）に変換
df["価格"] = df["価格"].astype(int)
print("=== 1. 価格を int に変換 ===")
print(f"価格のデータ型: {df['価格'].dtype}")

# 2. 「割引率」を小数（float）に変換
df["割引率"] = df["割引率"].astype(float)
print("\n=== 2. 割引率を float に変換 ===")
print(f"割引率のデータ型: {df['割引率'].dtype}")

# 3. 「在庫あり」を真偽値（bool）に変換
# 文字列の "True"/"False" を bool に変換
df["在庫あり"] = df["在庫あり"].map({"True": True, "False": False})
print("\n=== 3. 在庫ありを bool に変換 ===")
print(f"在庫ありのデータ型: {df['在庫あり'].dtype}")

# 4. 変換後に「売上」列を計算
df["売上"] = df["価格"] * (1 - df["割引率"])
print("\n=== 4. 売上を計算 ===")
print(df)

print("\n=== 変換後のデータ型 ===")
print(df.dtypes)
```

**実行結果:**
```
=== 元のデータ ===
  商品コード   価格 割引率  在庫あり
0        001  1000    0.1     True
1        002  2000    0.2    False
2        003  1500   0.15     True

=== 元のデータ型 ===
商品コード    object
価格        object
割引率      object
在庫あり    object
dtype: object

=== 1. 価格を int に変換 ===
価格のデータ型: int64

=== 2. 割引率を float に変換 ===
割引率のデータ型: float64

=== 3. 在庫ありを bool に変換 ===
在庫ありのデータ型: bool

=== 4. 売上を計算 ===
  商品コード  価格  割引率  在庫あり     売上
0        001  1000   0.10      True   900.0
1        002  2000   0.20     False  1600.0
2        003  1500   0.15      True  1275.0

=== 変換後のデータ型 ===
商品コード     object
価格           int64
割引率       float64
在庫あり        bool
売上         float64
dtype: object
```

</details>

---

## 📝 演習6: 文字列の整形

### 課題

以下のデータの文字列を整形してください。

```python
import pandas as pd

df = pd.DataFrame({
    "都道府県": ["  東京都  ", "OSAKA", "  福岡県", "愛知県  ", "hokkaido"],
    "顧客名": ["TANAKA", "Sato", "SUZUKI", "takahashi", "ITO"]
})

print("=== 元のデータ ===")
print(df)
```

1. 「都道府県」の前後の空白を削除
2. 「都道府県」をすべて大文字に統一
3. 「顧客名」をすべて小文字に統一
4. 整形後の結果を確認

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "都道府県": ["  東京都  ", "OSAKA", "  福岡県", "愛知県  ", "hokkaido"],
    "顧客名": ["TANAKA", "Sato", "SUZUKI", "takahashi", "ITO"]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「都道府県」の前後の空白を削除
df["都道府県"] = df["都道府県"].str.strip()
print("=== 1. 空白を削除 ===")
print(df["都道府県"])
print()

# 2. 「都道府県」をすべて大文字に統一
df["都道府県"] = df["都道府県"].str.upper()
print("=== 2. 大文字に統一 ===")
print(df["都道府県"])
print()

# 3. 「顧客名」をすべて小文字に統一
df["顧客名"] = df["顧客名"].str.lower()
print("=== 3. 顧客名を小文字に ===")
print(df["顧客名"])
print()

# 4. 整形後の結果を確認
print("=== 4. 整形後のデータ ===")
print(df)

# value_counts で確認
print("\n=== 都道府県の集計 ===")
print(df["都道府県"].value_counts())
```

**実行結果:**
```
=== 元のデータ ===
     都道府県      顧客名
0    東京都      TANAKA
1      OSAKA        Sato
2    福岡県      SUZUKI
3   愛知県    takahashi
4   hokkaido         ITO

=== 1. 空白を削除 ===
0       東京都
1       OSAKA
2       福岡県
3      愛知県
4    hokkaido
Name: 都道府県, dtype: object

=== 2. 大文字に統一 ===
0       東京都
1       OSAKA
2       福岡県
3      愛知県
4    HOKKAIDO
Name: 都道府県, dtype: object

=== 3. 顧客名を小文字に ===
0       tanaka
1         sato
2       suzuki
3    takahashi
4          ito
Name: 顧客名, dtype: object

=== 4. 整形後のデータ ===
   都道府県      顧客名
0     東京都     tanaka
1     OSAKA       sato
2     福岡県     suzuki
3    愛知県  takahashi
4  HOKKAIDO        ito

=== 都道府県の集計 ===
都道府県
東京都       1
OSAKA       1
福岡県       1
愛知県       1
HOKKAIDO    1
Name: count, dtype: int64
```

</details>

---

## 🎯 演習のまとめ

以下のスキルが身についたか確認しましょう：

| 演習 | スキル | チェック |
|------|--------|----------|
| 演習1 | isnull() で欠損値を確認できる | ☐ |
| 演習2 | dropna() で欠損値を削除できる | ☐ |
| 演習3 | fillna() で欠損値を補完できる | ☐ |
| 演習4 | duplicated(), drop_duplicates() で重複を処理できる | ☐ |
| 演習5 | astype() でデータ型を変換できる | ☐ |
| 演習6 | str.strip(), str.lower(), str.upper() で文字列を整形できる | ☐ |
