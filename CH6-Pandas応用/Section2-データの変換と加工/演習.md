# Section2: データの変換と加工 - 演習

## 🎯 この演習の目的

列の追加・削除、値の置換、apply() 関数、カテゴリ変換などの
基本操作を実際に手を動かして習得しましょう。

---

## 📝 演習1: 列の追加と削除

### 課題

以下のデータに対して、列の追加と削除を行ってください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["りんご", "みかん", "バナナ"],
    "数量": [10, 20, 15],
    "単価": [100, 50, 80],
    "備考": ["---", "---", "---"]
})

print("=== 元のデータ ===")
print(df)
```

1. 「売上」列を追加（数量 × 単価）
2. 「店舗」列を追加（すべて「本店」）
3. 「備考」列を削除

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["りんご", "みかん", "バナナ"],
    "数量": [10, 20, 15],
    "単価": [100, 50, 80],
    "備考": ["---", "---", "---"]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「売上」列を追加（数量 × 単価）
df["売上"] = df["数量"] * df["単価"]
print("=== 1. 売上列を追加 ===")
print(df)
print()

# 2. 「店舗」列を追加（すべて「本店」）
df["店舗"] = "本店"
print("=== 2. 店舗列を追加 ===")
print(df)
print()

# 3. 「備考」列を削除
df = df.drop(columns=["備考"])
print("=== 3. 備考列を削除 ===")
print(df)
```

**実行結果:**
```
=== 元のデータ ===
     商品  数量  単価   備考
0  りんご    10   100  ---
1  みかん    20    50  ---
2  バナナ    15    80  ---

=== 1. 売上列を追加 ===
     商品  数量  単価   備考    売上
0  りんご    10   100  ---   1000
1  みかん    20    50  ---   1000
2  バナナ    15    80  ---   1200

=== 2. 店舗列を追加 ===
     商品  数量  単価   備考    売上  店舗
0  りんご    10   100  ---   1000  本店
1  みかん    20    50  ---   1000  本店
2  バナナ    15    80  ---   1200  本店

=== 3. 備考列を削除 ===
     商品  数量  単価    売上  店舗
0  りんご    10   100   1000  本店
1  みかん    20    50   1000  本店
2  バナナ    15    80   1200  本店
```

</details>

---

## 📝 演習2: 値の置換（replace）

### 課題

以下のデータの値を置換してください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品ID": ["P001", "P002", "P003", "P004"],
    "カテゴリ": ["F", "V", "F", "D"],
    "在庫状況": [1, 0, 1, 0]
})

print("=== 元のデータ ===")
print(df)
```

1. 「カテゴリ」のコードを日本語に変換（F→果物、V→野菜、D→飲料）
2. 「在庫状況」を日本語に変換（1→在庫あり、0→在庫なし）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品ID": ["P001", "P002", "P003", "P004"],
    "カテゴリ": ["F", "V", "F", "D"],
    "在庫状況": [1, 0, 1, 0]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「カテゴリ」のコードを日本語に変換
df["カテゴリ"] = df["カテゴリ"].replace({
    "F": "果物",
    "V": "野菜",
    "D": "飲料"
})
print("=== 1. カテゴリを日本語に ===")
print(df)
print()

# 2. 「在庫状況」を日本語に変換
df["在庫状況"] = df["在庫状況"].replace({
    1: "在庫あり",
    0: "在庫なし"
})
print("=== 2. 在庫状況を日本語に ===")
print(df)
```

**実行結果:**
```
=== 元のデータ ===
  商品ID カテゴリ  在庫状況
0   P001        F         1
1   P002        V         0
2   P003        F         1
3   P004        D         0

=== 1. カテゴリを日本語に ===
  商品ID カテゴリ  在庫状況
0   P001     果物         1
1   P002     野菜         0
2   P003     果物         1
3   P004     飲料         0

=== 2. 在庫状況を日本語に ===
  商品ID カテゴリ   在庫状況
0   P001     果物   在庫あり
1   P002     野菜   在庫なし
2   P003     果物   在庫あり
3   P004     飲料   在庫なし
```

</details>

---

## 📝 演習3: apply() で関数を適用

### 課題

以下のデータに対して、apply() を使って変換を行ってください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C", "D"],
    "価格": [1000, 2500, 800, 3200]
})

print("=== 元のデータ ===")
print(df)
```

1. 「税込価格」列を追加（価格 × 1.1、小数点以下切り捨て）
2. 「価格帯」列を追加（2000円以上→「高額」、1000円以上→「中額」、それ以外→「低額」）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C", "D"],
    "価格": [1000, 2500, 800, 3200]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「税込価格」列を追加（価格 × 1.1、小数点以下切り捨て）

# 関数を定義する方法
def calc_tax_price(price):
    return int(price * 1.1)

df["税込価格"] = df["価格"].apply(calc_tax_price)

print("=== 1. 税込価格を追加 ===")
print(df)
print()

# 2. 「価格帯」列を追加

# 関数を定義する方法
def get_price_range(price):
    if price >= 2000:
        return "高額"
    elif price >= 1000:
        return "中額"
    else:
        return "低額"

df["価格帯"] = df["価格"].apply(get_price_range)

print("=== 2. 価格帯を追加 ===")
print(df)
print()

# ラムダ式でも書ける（1行の場合）
# df["税込価格"] = df["価格"].apply(lambda x: int(x * 1.1))
```

**実行結果:**
```
=== 元のデータ ===
  商品    価格
0    A   1000
1    B   2500
2    C    800
3    D   3200

=== 1. 税込価格を追加 ===
  商品    価格  税込価格
0    A   1000      1100
1    B   2500      2750
2    C    800       880
3    D   3200      3520

=== 2. 価格帯を追加 ===
  商品    価格  税込価格 価格帯
0    A   1000      1100   中額
1    B   2500      2750   高額
2    C    800       880   低額
3    D   3200      3520   高額
```

</details>

---

## 📝 演習4: 行全体に apply() を適用

### 課題

以下のデータに対して、行全体を使った処理を行ってください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C"],
    "数量": [10, 5, 8],
    "単価": [100, 200, 150],
    "割引率": [0.1, 0.2, 0.0]
})

print("=== 元のデータ ===")
print(df)
```

1. 「売上」列を追加（数量 × 単価 × (1 - 割引率)）
2. 「説明」列を追加（「商品Xを数量Y個販売」の形式）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C"],
    "数量": [10, 5, 8],
    "単価": [100, 200, 150],
    "割引率": [0.1, 0.2, 0.0]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「売上」列を追加（行全体を使った計算）

def calc_sales(row):
    return row["数量"] * row["単価"] * (1 - row["割引率"])

df["売上"] = df.apply(calc_sales, axis=1)

print("=== 1. 売上を追加 ===")
print(df)
print()

# 2. 「説明」列を追加

def create_description(row):
    return f"商品{row['商品']}を{row['数量']}個販売"

df["説明"] = df.apply(create_description, axis=1)

print("=== 2. 説明を追加 ===")
print(df)
```

**実行結果:**
```
=== 元のデータ ===
  商品  数量  単価  割引率
0    A    10   100     0.1
1    B     5   200     0.2
2    C     8   150     0.0

=== 1. 売上を追加 ===
  商品  数量  単価  割引率     売上
0    A    10   100     0.1    900.0
1    B     5   200     0.2    800.0
2    C     8   150     0.0   1200.0

=== 2. 説明を追加 ===
  商品  数量  単価  割引率     売上            説明
0    A    10   100     0.1    900.0  商品Aを10個販売
1    B     5   200     0.2    800.0   商品Bを5個販売
2    C     8   150     0.0   1200.0   商品Cを8個販売
```

</details>

---

## 📝 演習5: カテゴリ変換（cut）

### 課題

以下のデータを使って、年齢を年代に変換してください。

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋", "伊藤", "山田"],
    "年齢": [22, 35, 18, 45, 28, 55]
})

print("=== 元のデータ ===")
print(df)
```

1. 「年代」列を追加（10代、20代、30代、40代、50代以上に分類）
2. 各年代の人数を集計

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋", "伊藤", "山田"],
    "年齢": [22, 35, 18, 45, 28, 55]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 「年代」列を追加

# 区間の境界値を定義
bins = [0, 20, 30, 40, 50, 100]
# 各区間のラベル
labels = ["10代", "20代", "30代", "40代", "50代以上"]

df["年代"] = pd.cut(df["年齢"], bins=bins, labels=labels)

print("=== 1. 年代を追加 ===")
print(df)
print()

# 2. 各年代の人数を集計
print("=== 2. 年代別人数 ===")
print(df["年代"].value_counts().sort_index())
```

**実行結果:**
```
=== 元のデータ ===
   名前  年齢
0  田中    22
1  佐藤    35
2  鈴木    18
3  高橋    45
4  伊藤    28
5  山田    55

=== 1. 年代を追加 ===
   名前  年齢      年代
0  田中    22      20代
1  佐藤    35      30代
2  鈴木    18      10代
3  高橋    45      40代
4  伊藤    28      20代
5  山田    55  50代以上

=== 2. 年代別人数 ===
年代
10代        1
20代        2
30代        1
40代        1
50代以上    1
Name: count, dtype: int64
```

</details>

---

## 📝 演習6: 列名の変更と文字列操作

### 課題

以下のデータの列名を日本語に変更し、文字列を整形してください。

```python
import pandas as pd

df = pd.DataFrame({
    "name": ["  TANAKA  ", "sato", "SUZUKI"],
    "email": ["Tanaka@TEST.com", "SATO@example.COM", "suzuki@Mail.jp"],
    "status": ["active", "INACTIVE", "Active"]
})

print("=== 元のデータ ===")
print(df)
```

1. 列名を日本語に変更（name→名前、email→メール、status→状態）
2. 「名前」の空白を削除して小文字に統一
3. 「メール」を小文字に統一
4. 「状態」を小文字に統一

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "name": ["  TANAKA  ", "sato", "SUZUKI"],
    "email": ["Tanaka@TEST.com", "SATO@example.COM", "suzuki@Mail.jp"],
    "status": ["active", "INACTIVE", "Active"]
})

print("=== 元のデータ ===")
print(df)
print()

# 1. 列名を日本語に変更
df = df.rename(columns={
    "name": "名前",
    "email": "メール",
    "status": "状態"
})

print("=== 1. 列名を変更 ===")
print(df)
print()

# 2. 「名前」の空白を削除して小文字に統一
df["名前"] = df["名前"].str.strip().str.lower()

print("=== 2. 名前を整形 ===")
print(df)
print()

# 3. 「メール」を小文字に統一
df["メール"] = df["メール"].str.lower()

print("=== 3. メールを小文字に ===")
print(df)
print()

# 4. 「状態」を小文字に統一
df["状態"] = df["状態"].str.lower()

print("=== 4. 状態を小文字に ===")
print(df)
```

**実行結果:**
```
=== 元のデータ ===
          name             email    status
0    TANAKA    Tanaka@TEST.com    active
1          sato  SATO@example.COM  INACTIVE
2       SUZUKI    suzuki@Mail.jp    Active

=== 1. 列名を変更 ===
          名前             メール      状態
0    TANAKA    Tanaka@TEST.com    active
1          sato  SATO@example.COM  INACTIVE
2       SUZUKI    suzuki@Mail.jp    Active

=== 2. 名前を整形 ===
      名前             メール      状態
0   tanaka  Tanaka@TEST.com    active
1     sato  SATO@example.COM  INACTIVE
2   suzuki    suzuki@Mail.jp    Active

=== 3. メールを小文字に ===
      名前              メール      状態
0   tanaka  tanaka@test.com    active
1     sato  sato@example.com  INACTIVE
2   suzuki    suzuki@mail.jp    Active

=== 4. 状態を小文字に ===
      名前              メール      状態
0   tanaka  tanaka@test.com    active
1     sato  sato@example.com  inactive
2   suzuki    suzuki@mail.jp    active
```

</details>

---

## 🎯 演習のまとめ

以下のスキルが身についたか確認しましょう：

| 演習 | スキル | チェック |
|------|--------|----------|
| 演習1 | 列の追加・削除ができる | ☐ |
| 演習2 | replace() で値を置換できる | ☐ |
| 演習3 | apply() で関数を適用できる | ☐ |
| 演習4 | 行全体に apply() を適用できる（axis=1） | ☐ |
| 演習5 | cut() でカテゴリ変換できる | ☐ |
| 演習6 | rename() と str メソッドを使える | ☐ |
