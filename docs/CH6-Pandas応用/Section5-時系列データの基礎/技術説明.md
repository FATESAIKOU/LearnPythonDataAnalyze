# Section5: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®åŸºç¤Ž - æŠ€è¡“èª¬æ˜Ž

## ðŸŽ¯ ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å­¦ã¶ã“ã¨

æ—¥ä»˜ãƒ»æ™‚åˆ»ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ï¼ˆæ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ï¼‰ã¯ã€å£²ä¸Šåˆ†æžã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã€æ ªä¾¡ãªã©å¤šãã®å ´é¢ã§ç™»å ´ã—ã¾ã™ã€‚
Pandas ã®æ—¥ä»˜åž‹ï¼ˆdatetimeï¼‰ã¨æ™‚ç³»åˆ—æ“ä½œã‚’å­¦ã³ã¾ã™ã€‚

---

## 1. datetime åž‹ã¸ã®å¤‰æ›

### pd.to_datetime() ã®åŸºæœ¬

```
ã€æ–‡å­—åˆ— â†’ datetime åž‹ã¸ã®å¤‰æ›ã€‘

  å¤‰æ›å‰                              å¤‰æ›å¾Œ
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ index â”‚     æ—¥ä»˜     â”‚            â”‚ index â”‚     æ—¥ä»˜     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    å¤‰æ›    â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚   0   â”‚ "2024-01-15" â”‚  â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   0   â”‚ 2024-01-15   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚   1   â”‚ "2024-02-20" â”‚            â”‚   1   â”‚ 2024-02-20   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚   2   â”‚ "2024-03-10" â”‚            â”‚   2   â”‚ 2024-03-10   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       dtype: object                       dtype: datetime64[ns]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pd.to_datetime() ã§æ–‡å­—åˆ—ã‚’æ—¥ä»˜åž‹ã«å¤‰æ›                    â”‚
â”‚  â†’ æ—¥ä»˜ã®è¨ˆç®—ãƒ»æŠ½å‡ºãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ãªã‚‹            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

# æ–‡å­—åˆ—ã®æ—¥ä»˜
df = pd.DataFrame({
    "æ—¥ä»˜": ["2024-01-15", "2024-02-20", "2024-03-10"],
    "å£²ä¸Š": [10000, 12000, 15000]
})

print("=== å¤‰æ›å‰ ===")
print(df)
print(f"æ—¥ä»˜åˆ—ã®åž‹: {df['æ—¥ä»˜'].dtype}")

# datetime åž‹ã«å¤‰æ›
df["æ—¥ä»˜"] = pd.to_datetime(df["æ—¥ä»˜"])

print("\n=== å¤‰æ›å¾Œ ===")
print(df)
print(f"æ—¥ä»˜åˆ—ã®åž‹: {df['æ—¥ä»˜'].dtype}")
```

**å®Ÿè¡Œçµæžœ:**
```
=== å¤‰æ›å‰ ===
           æ—¥ä»˜     å£²ä¸Š
0  2024-01-15  10000
1  2024-02-20  12000
2  2024-03-10  15000
æ—¥ä»˜åˆ—ã®åž‹: object

=== å¤‰æ›å¾Œ ===
        æ—¥ä»˜     å£²ä¸Š
0 2024-01-15  10000
1 2024-02-20  12000
2 2024-03-10  15000
æ—¥ä»˜åˆ—ã®åž‹: datetime64[ns]
```

### æ§˜ã€…ãªæ—¥ä»˜å½¢å¼ã®å¤‰æ›

```python
import pandas as pd

# æ§˜ã€…ãªå½¢å¼
dates = pd.Series(["2024/01/15", "2024/02/20", "2024/03/10"])
print("=== ã‚¹ãƒ©ãƒƒã‚·ãƒ¥å½¢å¼ ===")
print(pd.to_datetime(dates))

dates2 = pd.Series(["15-01-2024", "20-02-2024", "10-03-2024"])
print("\n=== æ—¥-æœˆ-å¹´ å½¢å¼ï¼ˆformat æŒ‡å®šï¼‰===")
print(pd.to_datetime(dates2, format="%d-%m-%Y"))

dates3 = pd.Series(["20240115", "20240220", "20240310"])
print("\n=== æ•°å­—å½¢å¼ ===")
print(pd.to_datetime(dates3, format="%Y%m%d"))
```

---

## 2. datetime åž‹ã®å±žæ€§ï¼ˆdt ã‚¢ã‚¯ã‚»ã‚µï¼‰

### æ—¥ä»˜ã®å„è¦ç´ ã‚’å–ã‚Šå‡ºã™

```
ã€dt ã‚¢ã‚¯ã‚»ã‚µã§æ—¥ä»˜è¦ç´ ã‚’æŠ½å‡ºã€‘

  å…ƒã® DataFrame                     è¦ç´ ã‚’æŠ½å‡ºã—ã¦åˆ—ã‚’è¿½åŠ 
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
  â”‚ index â”‚    æ—¥ä»˜    â”‚ å£²ä¸Š â”‚      â”‚ index â”‚    æ—¥ä»˜    â”‚ å£²ä¸Š â”‚  å¹´  â”‚  æœˆ  â”‚ æ›œæ—¥â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
  â”‚   0   â”‚ 2024-01-15 â”‚10000 â”‚  â†’  â”‚   0   â”‚ 2024-01-15 â”‚10000 â”‚ 2024 â”‚  1   â”‚  0  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
  â”‚   1   â”‚ 2024-02-20 â”‚12000 â”‚      â”‚   1   â”‚ 2024-02-20 â”‚12000 â”‚ 2024 â”‚  2   â”‚  1  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
                                                                         â†‘ æœˆæ›œ=0, ç«æ›œ=1...

  ä¸»ãª dt å±žæ€§:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å±žæ€§           â”‚ èª¬æ˜Ž                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ .dt.year       â”‚ å¹´                    â”‚
  â”‚ .dt.month      â”‚ æœˆ                    â”‚
  â”‚ .dt.day        â”‚ æ—¥                    â”‚
  â”‚ .dt.hour       â”‚ æ™‚                    â”‚
  â”‚ .dt.minute     â”‚ åˆ†                    â”‚
  â”‚ .dt.weekday    â”‚ æ›œæ—¥ï¼ˆ0=æœˆ, 6=æ—¥ï¼‰    â”‚
  â”‚ .dt.dayofweek  â”‚ æ›œæ—¥ï¼ˆweekday ã¨åŒã˜ï¼‰â”‚
  â”‚ .dt.dayofyear  â”‚ å¹´å†…ã®ä½•æ—¥ç›®          â”‚
  â”‚ .dt.quarter    â”‚ å››åŠæœŸï¼ˆ1-4ï¼‰         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

df = pd.DataFrame({
    "æ—¥ä»˜": pd.to_datetime(["2024-01-15", "2024-02-20", "2024-03-10"]),
    "å£²ä¸Š": [10000, 12000, 15000]
})

# dt ã‚¢ã‚¯ã‚»ã‚µã§å„è¦ç´ ã‚’æŠ½å‡º
df["å¹´"] = df["æ—¥ä»˜"].dt.year
df["æœˆ"] = df["æ—¥ä»˜"].dt.month
df["æ—¥"] = df["æ—¥ä»˜"].dt.day
df["æ›œæ—¥"] = df["æ—¥ä»˜"].dt.weekday  # 0=æœˆæ›œ, 6=æ—¥æ›œ
df["å››åŠæœŸ"] = df["æ—¥ä»˜"].dt.quarter

print("=== æ—¥ä»˜è¦ç´ ã®æŠ½å‡º ===")
print(df)
```

**å®Ÿè¡Œçµæžœ:**
```
=== æ—¥ä»˜è¦ç´ ã®æŠ½å‡º ===
        æ—¥ä»˜     å£²ä¸Š    å¹´   æœˆ   æ—¥  æ›œæ—¥  å››åŠæœŸ
0 2024-01-15  10000  2024   1  15    0       1
1 2024-02-20  12000  2024   2  20    1       1
2 2024-03-10  15000  2024   3  10    6       1
```

### æ›œæ—¥åã¸ã®å¤‰æ›

```python
import pandas as pd

df = pd.DataFrame({
    "æ—¥ä»˜": pd.to_datetime(["2024-01-15", "2024-01-16", "2024-01-17"]),
    "å£²ä¸Š": [10000, 12000, 15000]
})

# æ›œæ—¥åã‚’å–å¾—
df["æ›œæ—¥å"] = df["æ—¥ä»˜"].dt.day_name()

print("=== æ›œæ—¥å ===")
print(df)
```

---

## 3. æ—¥ä»˜ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### æ¡ä»¶ã‚’ä½¿ã£ãŸãƒ•ã‚£ãƒ«ã‚¿

```
ã€æ—¥ä»˜ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‘

  å…ƒã® DataFrame
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”‚ index â”‚    æ—¥ä»˜    â”‚ å£²ä¸Š â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”‚   0   â”‚ 2024-01-15 â”‚10000 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”‚   1   â”‚ 2024-02-20 â”‚12000 â”‚    df[df["æ—¥ä»˜"] >= "2024-02-01"]
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                â†“
  â”‚   2   â”‚ 2024-03-10 â”‚15000 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â”‚ index â”‚    æ—¥ä»˜    â”‚ å£²ä¸Š â”‚
                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
                                   â”‚   1   â”‚ 2024-02-20 â”‚12000 â”‚
                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
                                   â”‚   2   â”‚ 2024-03-10 â”‚15000 â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

df = pd.DataFrame({
    "æ—¥ä»˜": pd.to_datetime(["2024-01-15", "2024-02-20", "2024-03-10", 
                            "2024-04-05", "2024-05-25"]),
    "å£²ä¸Š": [10000, 12000, 15000, 18000, 20000]
})

print("=== å…ƒã®ãƒ‡ãƒ¼ã‚¿ ===")
print(df)

# 2024å¹´2æœˆä»¥é™ã®ãƒ‡ãƒ¼ã‚¿
after_feb = df[df["æ—¥ä»˜"] >= "2024-02-01"]
print("\n=== 2æœˆä»¥é™ ===")
print(after_feb)

# 2024å¹´1æœˆã€œ3æœˆã®ãƒ‡ãƒ¼ã‚¿
q1 = df[(df["æ—¥ä»˜"] >= "2024-01-01") & (df["æ—¥ä»˜"] < "2024-04-01")]
print("\n=== ç¬¬1å››åŠæœŸï¼ˆ1-3æœˆï¼‰===")
print(q1)

# ç‰¹å®šã®æœˆã®ãƒ‡ãƒ¼ã‚¿
march = df[df["æ—¥ä»˜"].dt.month == 3]
print("\n=== 3æœˆã®ãƒ‡ãƒ¼ã‚¿ ===")
print(march)
```

---

## 4. DatetimeIndex ã®è¨­å®š

### æ—¥ä»˜ã‚’ index ã«ã™ã‚‹

```
ã€DatetimeIndex ã®è¨­å®šã€‘

  é€šå¸¸ã® DataFrame                   æ—¥ä»˜ã‚’ index ã«è¨­å®š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”‚ index â”‚    æ—¥ä»˜    â”‚ å£²ä¸Š â”‚      â”‚   index    â”‚ å£²ä¸Š â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤      â”‚  (æ—¥ä»˜)    â”‚      â”‚
  â”‚   0   â”‚ 2024-01-15 â”‚10000 â”‚  â†’  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤      â”‚ 2024-01-15 â”‚10000 â”‚
  â”‚   1   â”‚ 2024-02-20 â”‚12000 â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜      â”‚ 2024-02-20 â”‚12000 â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DatetimeIndex ã«ã™ã‚‹ã¨:                                    â”‚
â”‚  - æ—¥ä»˜ã§ã® .loc ã‚¢ã‚¯ã‚»ã‚¹ãŒä¾¿åˆ©                             â”‚
â”‚  - resample() ã§æ™‚é–“é›†è¨ˆãŒå¯èƒ½                              â”‚
â”‚  - æ™‚ç³»åˆ—ãƒ—ãƒ­ãƒƒãƒˆæ™‚ã« x è»¸ãŒè‡ªå‹•ã§æ—¥ä»˜ã«ãªã‚‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

df = pd.DataFrame({
    "æ—¥ä»˜": pd.to_datetime(["2024-01-15", "2024-02-20", "2024-03-10"]),
    "å£²ä¸Š": [10000, 12000, 15000]
})

print("=== é€šå¸¸ã® DataFrame ===")
print(df)
print(f"index: {df.index.tolist()}")

# æ—¥ä»˜ã‚’ index ã«è¨­å®š
df_indexed = df.set_index("æ—¥ä»˜")
print("\n=== DatetimeIndex è¨­å®šå¾Œ ===")
print(df_indexed)
print(f"index: {df_indexed.index.tolist()}")
```

**å®Ÿè¡Œçµæžœ:**
```
=== é€šå¸¸ã® DataFrame ===
        æ—¥ä»˜     å£²ä¸Š
0 2024-01-15  10000
1 2024-02-20  12000
2 2024-03-10  15000
index: [0, 1, 2]

=== DatetimeIndex è¨­å®šå¾Œ ===
              å£²ä¸Š
æ—¥ä»˜              
2024-01-15  10000
2024-02-20  12000
2024-03-10  15000
index: [Timestamp('2024-01-15 00:00:00'), ...]
```

### DatetimeIndex ã§ã®ã‚¹ãƒ©ã‚¤ã‚¹

```python
import pandas as pd

df = pd.DataFrame({
    "æ—¥ä»˜": pd.to_datetime(["2024-01-15", "2024-02-20", "2024-03-10", 
                            "2024-04-05", "2024-05-25"]),
    "å£²ä¸Š": [10000, 12000, 15000, 18000, 20000]
})

df = df.set_index("æ—¥ä»˜")

print("=== DatetimeIndex ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ ===")

# ç‰¹å®šã®æ—¥ä»˜
print("2024-02-20 ã®ãƒ‡ãƒ¼ã‚¿:")
print(df.loc["2024-02-20"])

# å¹´æœˆã§ã‚¹ãƒ©ã‚¤ã‚¹
print("\n2024å¹´2æœˆã€œ3æœˆ:")
print(df.loc["2024-02":"2024-03"])

# å¹´ã ã‘ã§ã‚¹ãƒ©ã‚¤ã‚¹
print("\n2024å¹´ã®ãƒ‡ãƒ¼ã‚¿:")
print(df.loc["2024"])
```

---

## 5. resample() ã§æ™‚é–“å˜ä½ã®é›†è¨ˆ

### resample ã®åŸºæœ¬

```
ã€resample() = æ™‚é–“å˜ä½ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ– + é›†è¨ˆã€‘

  æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ï¼ˆDatetimeIndexï¼‰
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”‚   index    â”‚ å£²ä¸Š â”‚
  â”‚  (æ—¥ä»˜)    â”‚      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-05 â”‚ 100  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤        resample("ME").sum()
  â”‚ 2024-01-15 â”‚ 150  â”‚              â†“
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-25 â”‚ 200  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤    â”‚   index    â”‚ å£²ä¸Š â”‚
  â”‚ 2024-02-10 â”‚ 180  â”‚    â”‚ (æœˆæœ«æ—¥ä»˜) â”‚      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-02-20 â”‚ 220  â”‚    â”‚ 2024-01-31 â”‚ 450  â”‚  â† 1æœˆåˆè¨ˆ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
                           â”‚ 2024-02-29 â”‚ 400  â”‚  â† 2æœˆåˆè¨ˆ
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

ã€resample å˜ä½ã‚³ãƒ¼ãƒ‰ã€‘

å£²ä¸Šã®æŽ¨ç§»
    ^
450 â”‚     â—
400 â”‚               â—
350 â”‚
300 â”‚
250 â”‚
200 â”‚
150 â”‚
100 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ™‚é–“
        1æœˆ      2æœˆ

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ã‚³ãƒ¼ãƒ‰â”‚ æ„å‘³                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ "D"   â”‚ æ—¥ï¼ˆDayï¼‰            â”‚
  â”‚ "W"   â”‚ é€±ï¼ˆWeekï¼‰           â”‚
  â”‚ "ME"  â”‚ æœˆæœ«ï¼ˆMonth Endï¼‰    â”‚
  â”‚ "MS"  â”‚ æœˆåˆï¼ˆMonth Startï¼‰  â”‚
  â”‚ "QE"  â”‚ å››åŠæœŸæœ«             â”‚
  â”‚ "YE"  â”‚ å¹´æœ«                 â”‚
  â”‚ "h"   â”‚ æ™‚é–“ï¼ˆhourï¼‰         â”‚
  â”‚ "min" â”‚ åˆ†ï¼ˆminuteï¼‰         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

# æ—¥æ¬¡å£²ä¸Šãƒ‡ãƒ¼ã‚¿
dates = pd.date_range("2024-01-01", periods=60, freq="D")
sales = pd.DataFrame({
    "å£²ä¸Š": [100 + i * 5 + (i % 7) * 10 for i in range(60)]
}, index=dates)

print("=== æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ï¼ˆå…ˆé ­10ä»¶ï¼‰===")
print(sales.head(10))

# æœˆæ¬¡ã«é›†è¨ˆ
monthly = sales.resample("ME").sum()
print("\n=== æœˆæ¬¡é›†è¨ˆ ===")
print(monthly)

# é€±æ¬¡ã«é›†è¨ˆ
weekly = sales.resample("W").sum()
print("\n=== é€±æ¬¡é›†è¨ˆï¼ˆå…ˆé ­5ä»¶ï¼‰===")
print(weekly.head())
```

**å®Ÿè¡Œçµæžœ:**
```
=== æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿ï¼ˆå…ˆé ­10ä»¶ï¼‰===
            å£²ä¸Š
2024-01-01   100
2024-01-02   115
2024-01-03   130
2024-01-04   145
2024-01-05   160
2024-01-06   175
2024-01-07   130
2024-01-08   145
2024-01-09   160
2024-01-10   175

=== æœˆæ¬¡é›†è¨ˆ ===
              å£²ä¸Š
2024-01-31   5890
2024-02-29   8380
2024-03-31   2480

=== é€±æ¬¡é›†è¨ˆï¼ˆå…ˆé ­5ä»¶ï¼‰===
              å£²ä¸Š
2024-01-07    955
2024-01-14   1120
2024-01-21   1295
2024-01-28   1470
2024-02-04   1645
```

### resample ã§ã®å„ç¨®é›†è¨ˆ

```python
import pandas as pd

dates = pd.date_range("2024-01-01", periods=30, freq="D")
sales = pd.DataFrame({
    "å£²ä¸Š": [100 + i * 10 for i in range(30)]
}, index=dates)

print("=== æœˆæ¬¡é›†è¨ˆï¼ˆæ§˜ã€…ãªé–¢æ•°ï¼‰===")
print(f"åˆè¨ˆ: \n{sales.resample('ME').sum()}\n")
print(f"å¹³å‡: \n{sales.resample('ME').mean()}\n")
print(f"ä»¶æ•°: \n{sales.resample('ME').count()}\n")
```

---

## 6. ç§»å‹•å¹³å‡ï¼ˆrollingï¼‰

### rolling ã®åŸºæœ¬

```
ã€rolling() = ç§»å‹•çª“ã§ã®è¨ˆç®—ã€‘

  æ—¥æ¬¡ãƒ‡ãƒ¼ã‚¿                     3æ—¥ç§»å‹•å¹³å‡
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   index    â”‚ å£²ä¸Š â”‚          â”‚   index    â”‚ å£²ä¸Š â”‚ ç§»å‹•å¹³å‡â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-01 â”‚ 100  â”‚          â”‚ 2024-01-01 â”‚ 100  â”‚   NaN   â”‚ â† ãƒ‡ãƒ¼ã‚¿ä¸è¶³
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-02 â”‚ 120  â”‚          â”‚ 2024-01-02 â”‚ 120  â”‚   NaN   â”‚ â† ãƒ‡ãƒ¼ã‚¿ä¸è¶³
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-03 â”‚ 110  â”‚    â†’    â”‚ 2024-01-03 â”‚ 110  â”‚  110.0  â”‚ â† (100+120+110)/3
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-04 â”‚ 130  â”‚          â”‚ 2024-01-04 â”‚ 130  â”‚  120.0  â”‚ â† (120+110+130)/3
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2024-01-05 â”‚ 140  â”‚          â”‚ 2024-01-05 â”‚ 140  â”‚  126.7  â”‚ â† (110+130+140)/3
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ç§»å‹•å¹³å‡ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼‰ã€‘

å£²ä¸Š
  ^
140â”‚                       â—
130â”‚                  â—
120â”‚                                  â”â”â” ç§»å‹•å¹³å‡ï¼ˆãªã‚ã‚‰ã‹ï¼‰
110â”‚             â—
100â”‚ (NaN)(NaN)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¥ä»˜
      1/1  1/2  1/3  1/4  1/5

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§»å‹•å¹³å‡ = ãƒ‡ãƒ¼ã‚¿ã®ãƒŽã‚¤ã‚ºã‚’å¹³æ»‘åŒ–ã—ã¦å‚¾å‘ã‚’è¦‹ã‚„ã™ãã™ã‚‹    â”‚
â”‚  rolling(3) = éŽåŽ»3æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦è¨ˆç®—                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import pandas as pd

dates = pd.date_range("2024-01-01", periods=10, freq="D")
sales = pd.DataFrame({
    "å£²ä¸Š": [100, 120, 110, 130, 140, 125, 150, 145, 160, 155]
}, index=dates)

# 3æ—¥ç§»å‹•å¹³å‡
sales["3æ—¥ç§»å‹•å¹³å‡"] = sales["å£²ä¸Š"].rolling(3).mean()

# 5æ—¥ç§»å‹•å¹³å‡
sales["5æ—¥ç§»å‹•å¹³å‡"] = sales["å£²ä¸Š"].rolling(5).mean()

print("=== ç§»å‹•å¹³å‡ ===")
print(sales)
```

**å®Ÿè¡Œçµæžœ:**
```
=== ç§»å‹•å¹³å‡ ===
            å£²ä¸Š  3æ—¥ç§»å‹•å¹³å‡  5æ—¥ç§»å‹•å¹³å‡
2024-01-01   100         NaN         NaN
2024-01-02   120         NaN         NaN
2024-01-03   110      110.00         NaN
2024-01-04   130      120.00         NaN
2024-01-05   140      126.67      120.0
2024-01-06   125      131.67      125.0
2024-01-07   150      138.33      131.0
2024-01-08   145      140.00      138.0
2024-01-09   160      151.67      144.0
2024-01-10   155      153.33      147.0
```

### ç§»å‹•åˆè¨ˆãƒ»æœ€å¤§å€¤ãªã©

```python
import pandas as pd

dates = pd.date_range("2024-01-01", periods=7, freq="D")
sales = pd.DataFrame({
    "å£²ä¸Š": [100, 120, 110, 130, 140, 125, 150]
}, index=dates)

# 3æ—¥ç§»å‹•åˆè¨ˆ
sales["3æ—¥åˆè¨ˆ"] = sales["å£²ä¸Š"].rolling(3).sum()

# 3æ—¥ç§»å‹•æœ€å¤§
sales["3æ—¥æœ€å¤§"] = sales["å£²ä¸Š"].rolling(3).max()

print("=== ç§»å‹•åˆè¨ˆãƒ»æœ€å¤§ ===")
print(sales)
```

---

## 7. å®Ÿè·µï¼šæ—¥æ¬¡å£²ä¸Šã®åˆ†æž

### ç·åˆä¾‹

```python
import pandas as pd

# 60æ—¥é–“ã®å£²ä¸Šãƒ‡ãƒ¼ã‚¿
dates = pd.date_range("2024-01-01", periods=60, freq="D")
import random
random.seed(42)
sales_data = [1000 + i * 20 + random.randint(-100, 100) for i in range(60)]

df = pd.DataFrame({
    "å£²ä¸Š": sales_data
}, index=dates)

print("=== æ—¥æ¬¡å£²ä¸Šãƒ‡ãƒ¼ã‚¿ï¼ˆå…ˆé ­10ä»¶ï¼‰===")
print(df.head(10))

# æœˆåˆ¥é›†è¨ˆ
print("\n=== æœˆåˆ¥å£²ä¸Š ===")
monthly = df.resample("ME").agg(["sum", "mean", "count"])
print(monthly)

# é€±åˆ¥é›†è¨ˆ
print("\n=== é€±åˆ¥å£²ä¸Šï¼ˆå…ˆé ­5é€±ï¼‰===")
weekly = df.resample("W").sum()
print(weekly.head())

# 7æ—¥ç§»å‹•å¹³å‡
df["7æ—¥ç§»å‹•å¹³å‡"] = df["å£²ä¸Š"].rolling(7).mean()
print("\n=== 7æ—¥ç§»å‹•å¹³å‡ï¼ˆä¸€éƒ¨ï¼‰===")
print(df.iloc[5:15])

# æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š
df["æ›œæ—¥"] = df.index.dayofweek
weekday_avg = df.groupby("æ›œæ—¥")["å£²ä¸Š"].mean()
print("\n=== æ›œæ—¥åˆ¥å¹³å‡å£²ä¸Š ===")
weekday_names = ["æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ", "æ—¥"]
for i, avg in enumerate(weekday_avg):
    print(f"{weekday_names[i]}æ›œæ—¥: {avg:.0f}å††")
```

**å®Ÿè¡Œçµæžœ:**
```
=== æ—¥æ¬¡å£²ä¸Šãƒ‡ãƒ¼ã‚¿ï¼ˆå…ˆé ­10ä»¶ï¼‰===
             å£²ä¸Š
2024-01-01   910
2024-01-02  1016
2024-01-03  1055
2024-01-04  1115
2024-01-05  1023
...

=== æœˆåˆ¥å£²ä¸Š ===
              å£²ä¸Š                
               sum       mean count
2024-01-31   38245  1233.71     31
2024-02-29   46830  1614.83     29

=== 7æ—¥ç§»å‹•å¹³å‡ï¼ˆä¸€éƒ¨ï¼‰===
             å£²ä¸Š  7æ—¥ç§»å‹•å¹³å‡  æ›œæ—¥
2024-01-06  1130    1041.57     5
2024-01-07  1120    1052.71     6
...
```

---

## âœ… ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å­¦ã‚“ã ã“ã¨

1. **pd.to_datetime()**: æ–‡å­—åˆ—ã‚’æ—¥ä»˜åž‹ã«å¤‰æ›
2. **dt ã‚¢ã‚¯ã‚»ã‚µ**: year, month, day, weekday ãªã©ã®æŠ½å‡º
3. **æ—¥ä»˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ¯”è¼ƒæ¼”ç®—å­ã‚„ dt å±žæ€§ã§æ¡ä»¶æŠ½å‡º
4. **DatetimeIndex**: æ—¥ä»˜ã‚’ index ã«ã—ã¦æ™‚ç³»åˆ—æ“ä½œã‚’ä¾¿åˆ©ã«
5. **resample()**: æ—¥æ¬¡â†’æœˆæ¬¡ãªã©æ™‚é–“å˜ä½ã§ã®é›†è¨ˆ
6. **rolling()**: ç§»å‹•å¹³å‡ãªã©ã®çª“é–¢æ•°è¨ˆç®—

---

## ðŸ”— æ¬¡ã®ç« 

æ¬¡ã¯ã€ŒCH7: Matplotlibå…¥é–€ã€ã§ã€
ã‚°ãƒ©ãƒ•ã‚’ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–ã‚’å­¦ã³ã¾ã™ï¼
