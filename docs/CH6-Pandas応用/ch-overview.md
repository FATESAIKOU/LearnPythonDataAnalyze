# CH6: Pandas 応用 - データの加工と集計

## 🎯 この章の目的

Pandas を使ってデータのクリーニング、変換、集計ができるようになることを目指します。
実際のデータ分析で必要となる「データを整える」スキルを習得し、分析レポートを作成する準備を整えます。

---

## 📚 教授技術

| セクション | トピック | 学習内容 |
|------------|----------|----------|
| Section1 | データのクリーニング | 欠損値処理、重複削除、データ型変換 |
| Section2 | データの変換と加工 | 列の追加・削除、値の置換、apply関数 |
| Section3 | データの結合 | concat、merge、join によるデータ統合 |
| Section4 | グループ化と集計 | groupby、集計関数、ピボットテーブル |
| Section5 | 時系列データの基礎 | 日付型、日付操作、リサンプリング |

---

## 🎓 教授方法

### アプローチ
- **現実のデータを想定**: 実務で遭遇する「汚いデータ」を扱う経験
- **Before/After で確認**: 操作前後のデータを比較して変化を理解
- **Excel 経験者向け**: ピボットテーブルなど Excel の機能との対応

### 進め方
1. 各セクションの「技術説明.md」を読む
2. サンプルデータを使って実際に操作
3. データの変化を常に確認
4. 「演習.md」で基本操作を練習
5. 「応用問題.md」で実践的なデータ加工にチャレンジ

---

## 📖 セクション構成

### Section1: データのクリーニング
**目標**: 欠損値や重複を処理し、きれいなデータを作成できる

- 欠損値の確認（isnull, isna, notnull）
- 欠損値の削除（dropna）
- 欠損値の補完（fillna）
- 重複の確認と削除（duplicated, drop_duplicates）
- データ型の変換（astype）
- 文字列の整形（strip, lower, upper）

### Section2: データの変換と加工
**目標**: データを変換し、新しい列を追加できる

- 列の追加と削除（新規列、drop）
- 値の置換（replace, map）
- apply() で関数を適用
- カテゴリ変換（cut, qcut）
- 文字列メソッド（str アクセサ）
- rename() で列名・インデックス名の変更

### Section3: データの結合
**目標**: 複数のデータを統合できる

- concat() で縦・横方向に結合
- merge() でキーを使った結合（SQL の JOIN 相当）
- 結合の種類（inner, outer, left, right）
- join() でインデックスを使った結合
- 結合時の重複列の処理

### Section4: グループ化と集計
**目標**: データをグループ化して集計できる

- groupby() の基本
- 集計関数（sum, mean, count, max, min）
- 複数列でグループ化
- agg() で複数の集計を同時に実行
- transform() でグループごとの変換
- pivot_table() でピボットテーブル作成
- crosstab() でクロス集計

### Section5: 時系列データの基礎
**目標**: 日付データを扱い、時系列分析の準備ができる

- datetime 型への変換（pd.to_datetime）
- datetime 型の属性（year, month, day, weekday）
- 日付によるフィルタリング
- DatetimeIndex の設定
- resample() で時間単位の集計
- 移動平均の計算（rolling）

---

## ⏰ 想定学習時間

| セクション | 時間 |
|------------|------|
| Section1: データのクリーニング | 45-60 分 |
| Section2: データの変換と加工 | 45-60 分 |
| Section3: データの結合 | 45-60 分 |
| Section4: グループ化と集計 | 60-75 分 |
| Section5: 時系列データの基礎 | 45-60 分 |
| **合計** | **4-5 時間** |

---

## ✅ この章の修了条件

以下ができるようになれば、この章は修了です：

- [ ] 欠損値を確認し、削除または補完できる
- [ ] 重複データを削除できる
- [ ] 新しい列を追加し、既存の列を変換できる
- [ ] 複数のデータフレームを結合できる
- [ ] groupby で集計ができる
- [ ] ピボットテーブルを作成できる
- [ ] 日付データを扱える

---

## 💡 つまずきやすいポイント

| 問題 | 解決策 |
|------|--------|
| 欠損値が残っている | dropna() は元のデータを変更しない。inplace=True または代入が必要 |
| merge で行が増えた | 結合キーに重複がないか確認。how パラメータを確認 |
| groupby の結果が複雑 | reset_index() で通常の DataFrame に戻す |
| 日付に変換できない | format パラメータで日付形式を明示的に指定 |

---

## 🔗 前提知識

この章を学ぶには、CH5 の以下の内容を理解している必要があります：

- Series と DataFrame の基本操作
- データの読み込みと保存
- loc/iloc によるデータ選択
- 条件によるフィルタリング

---

## 📊 使用するサンプルデータ

この章では以下のサンプルデータを使用します：

- `sample_sales.csv` - 売上データ（欠損値あり）
- `sample_products.csv` - 商品マスタ
- `sample_customers.csv` - 顧客マスタ

---

## 🚀 次の章への準備

この章を終えると、CH7「Matplotlib 入門」でデータの可視化を学びます。
ここで学んだ集計スキルは、グラフを作成する際のデータ準備に直接役立ちます。
