# CH4: NumPy 入門 - 学習の動機づけ

## 🎯 なぜ NumPy を学ぶのか？

Excel で大量のデータを扱うとき、処理が重くなったことはありませんか？
数万行のデータで計算すると、固まってしまうことはありませんか？

NumPy を学ぶことで、**大量の数値データを高速に処理** できるようになります。
また、NumPy は Pandas や Matplotlib の基盤となる技術です。

```
┌─────────────────────────────────────────────────────────────────┐
│                  NumPy を学ぶ目的                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ⚡ 高速な計算          →  100万件のデータも一瞬で処理         │
│                                                                 │
│   📊 配列操作の基礎      →  Pandas を学ぶための土台になる      │
│                                                                 │
│   🔢 一括計算ができる    →  ループを書かずに全要素を計算       │
│                                                                 │
│   📈 データ分析の入口    →  統計量の計算が簡単にできる         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔑 この章を学ぶための前提条件

```
┌─────────────────────────────────────────────────────────────────┐
│                      学習の前提条件                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ✅ 条件 1: CH1-CH3 の内容を理解している                        │
│     ─────────────────────────────────────────────────           │
│     • 変数・リスト・for ループが使える                          │
│     • import でモジュールを読み込める                           │
│                                                                 │
│  ✅ 条件 2: Excel で表形式データを扱ったことがある              │
│     ─────────────────────────────────────────────────           │
│     • 行と列の概念がわかる                                      │
│     • SUM, AVERAGE などの集計関数を使ったことがある             │
│                                                                 │
│  ✅ 条件 3: 「大量データを効率的に処理したい」と思っている      │
│     ─────────────────────────────────────────────────           │
│     • Excel の限界を感じたことがある                            │
│     • もっと高速に計算したい                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 この章を学ぶと何が変わるのか？（As-Is / To-Be 比較）

### 変化1: 大量データの計算が一瞬で終わる

**シナリオ**: 100万個の数値それぞれを2倍にしたい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌───────┬─────────────┐                                               │
│   │   A   │      B      │                                               │
│   ├───────┼─────────────┤                                               │
│   │   1   │  =A1*2      │                                               │
│   │   2   │  =A2*2      │  ← 100万行分の式をコピー...                  │
│   │   3   │  =A3*2      │                                               │
│   │  ...  │    ...      │                                               │
│   │1000000│ =A1000000*2 │                                               │
│   └───────┴─────────────┘                                               │
│                                                                         │
│   😰 問題点:                                                            │
│   • ファイルサイズが巨大になる                                          │
│   • 開くだけで時間がかかる                                              │
│   • 計算中に固まることがある                                            │
│   • そもそも100万行は Excel の限界に近い                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: NumPy の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  import numpy as np                                             │   │
│   │                                                                 │   │
│   │  # 100万個の数値を作成                                          │   │
│   │  data = np.arange(1, 1000001)                                   │   │
│   │                                                                 │   │
│   │  # 全要素を2倍（ループなし！）                                  │   │
│   │  result = data * 2                                              │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   処理時間の比較:                                                       │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                 │   │
│   │   Python リスト + for ループ:  約 100 ミリ秒                    │   │
│   │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                  │   │
│   │                                                                 │   │
│   │   NumPy 配列:                  約 1 ミリ秒                      │   │
│   │   ━━                                                            │   │
│   │                                                                 │   │
│   │   → NumPy は約 100倍 高速！                                    │   │
│   │                                                                 │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 100万件でも一瞬で処理完了                                           │
│   • メモリ効率が良い                                                    │
│   • コードがシンプル（ループ不要）                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 変化2: 集計関数が1行で書ける

**シナリオ**: 売上データの合計・平均・最大・最小を計算したい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │      A      │        B          │                               │   │
│   ├─────────────┼───────────────────┤                               │   │
│   │    売上     │                   │                               │   │
│   ├─────────────┼───────────────────┤                               │   │
│   │    120      │                   │                               │   │
│   │    85       │                   │                               │   │
│   │    200      │                   │                               │   │
│   │    ...      │                   │                               │   │
│   ├─────────────┼───────────────────┤                               │   │
│   │    合計     │  =SUM(A2:A100)    │  ← それぞれの関数を入力      │   │
│   │    平均     │  =AVERAGE(A2:A100)│                               │   │
│   │    最大     │  =MAX(A2:A100)    │                               │   │
│   │    最小     │  =MIN(A2:A100)    │                               │   │
│   │   標準偏差  │  =STDEV(A2:A100)  │                               │   │
│   └─────────────┴───────────────────┘                               │   │
│                                                                         │
│   😰 問題点:                                                            │
│   • 範囲（A2:A100）を毎回指定する必要がある                             │
│   • データ範囲が変わると式を修正する必要がある                          │
│   • 複数シートにまたがる計算は複雑になる                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: NumPy の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  import numpy as np                                             │   │
│   │                                                                 │   │
│   │  sales = np.array([120, 85, 200, 150, 180, 95, 220, 160])       │   │
│   │                                                                 │   │
│   │  print(f"合計: {sales.sum()}")        # → 合計: 1210           │   │
│   │  print(f"平均: {sales.mean()}")       # → 平均: 151.25         │   │
│   │  print(f"最大: {sales.max()}")        # → 最大: 220            │   │
│   │  print(f"最小: {sales.min()}")        # → 最小: 85             │   │
│   │  print(f"標準偏差: {sales.std()}")    # → 標準偏差: 45.88...   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 配列に対して直接メソッドを呼び出すだけ                              │
│   • 範囲指定が不要（配列全体が対象）                                    │
│   • データが増えてもコード変更不要                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 変化3: 条件に合うデータを簡単に抽出できる

**シナリオ**: 100以上の売上データだけを抽出したい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   方法1: フィルター機能を使う                                           │
│   ┌────────────────────────────────────────────────────────────┐        │
│   │  ① [データ] → [フィルター]                               │        │
│   │  ② 売上列のドロップダウンをクリック                       │        │
│   │  ③ [数値フィルター] → [指定の値以上]                     │        │
│   │  ④ 「100」と入力 → [OK]                                  │        │
│   └────────────────────────────────────────────────────────────┘        │
│                                                                         │
│   方法2: 別列で IF を使う                                               │
│   ┌────────────────────────────────────────────────────────────┐        │
│   │  =IF(A2>=100, A2, "")   ← 条件を満たさない場合は空白      │        │
│   │  → でも空白行が残る...                                    │        │
│   └────────────────────────────────────────────────────────────┘        │
│                                                                         │
│   😰 問題点:                                                            │
│   • 手順が多い                                                          │
│   • 抽出結果を別の計算に使いにくい                                      │
│   • 条件を変えるたびに操作が必要                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: NumPy の場合（ブールインデックス）                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  import numpy as np                                             │   │
│   │                                                                 │   │
│   │  sales = np.array([120, 85, 200, 150, 45, 180, 95, 220])        │   │
│   │                                                                 │   │
│   │  # 100以上のデータを抽出（1行！）                               │   │
│   │  high_sales = sales[sales >= 100]                               │   │
│   │                                                                 │   │
│   │  print(high_sales)  # → [120 200 150 180 220]                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   仕組み:                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                 │   │
│   │   sales >= 100 の結果:                                          │   │
│   │   [True, False, True, True, False, True, False, True]           │   │
│   │                                                                 │   │
│   │   この True/False の配列で元データをフィルタリング:             │   │
│   │   sales[True, False, True, ...] → True の位置だけ抽出          │   │
│   │                                                                 │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 1行で条件抽出が完了                                                 │
│   • 抽出結果をそのまま計算に使える                                      │
│   • 条件を変えるのも簡単（数字を変えるだけ）                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📚 この章で学ぶ内容

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       CH4 の学習内容                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Section 1: NumPy 配列の基本                                            │
│  ────────────────────────────                                           │
│  • 配列の作成と基本属性を理解する                                       │
│                                                                         │
│      Python リスト:           NumPy 配列:                               │
│      ┌───┬───┬───┬───┐        ┌───┬───┬───┬───┐                         │
│      │ 1 │ 2 │ 3 │ 4 │        │ 1 │ 2 │ 3 │ 4 │                         │
│      └───┴───┴───┴───┘        └───┴───┴───┴───┘                         │
│      [1, 2, 3, 4]              np.array([1, 2, 3, 4])                   │
│                                                                         │
│      違い: NumPy 配列は全要素が同じ型、高速計算が可能                   │
│                                                                         │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                         │
│  Section 2: 配列の操作                                                  │
│  ────────────────────────────                                           │
│  • インデックス・スライスで要素にアクセス                               │
│                                                                         │
│      2次元配列（Excel の表に相当）:                                     │
│      ┌─────────────────────────────┐                                    │
│      │        列0    列1    列2    │                                    │
│      │  行0 [  1  ,   2  ,   3  ]  │                                    │
│      │  行1 [  4  ,   5  ,   6  ]  │                                    │
│      │  行2 [  7  ,   8  ,   9  ]  │                                    │
│      └─────────────────────────────┘                                    │
│                                                                         │
│      arr[1, 2] → 6  （行1、列2の要素）                                 │
│      arr[0, :] → [1, 2, 3]  （行0の全要素）                            │
│      arr[:, 1] → [2, 5, 8]  （列1の全要素）                            │
│                                                                         │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                         │
│  Section 3: 配列の計算                                                  │
│  ────────────────────────────                                           │
│  • 配列同士の計算とブロードキャスト                                     │
│                                                                         │
│      配列 + 配列（要素ごとの計算）:                                     │
│      ┌───┬───┬───┐   ┌───┬───┬───┐   ┌───┬───┬───┐                      │
│      │ 1 │ 2 │ 3 │ + │ 4 │ 5 │ 6 │ = │ 5 │ 7 │ 9 │                      │
│      └───┴───┴───┘   └───┴───┴───┘   └───┴───┴───┘                      │
│                                                                         │
│      配列 * 数値（ブロードキャスト）:                                   │
│      ┌───┬───┬───┐       ┌───┬───┬───┐                                  │
│      │ 1 │ 2 │ 3 │ * 2 = │ 2 │ 4 │ 6 │                                  │
│      └───┴───┴───┘       └───┴───┴───┘                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🏁 この章のゴール

```
┌───────────────────────────────────────────────────────────────────────────┐
│                        CH4 修了時の姿                                     │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│   ┌───────────────────────────────────────────────────────────────────┐   │
│   │  # この章を修了すると、このコードが「書ける」ようになります       │   │
│   │                                                                   │   │
│   │  import numpy as np                                               │   │
│   │                                                                   │   │
│   │  # 売上データ（2週間分、7日×2週）                                 │   │
│   │  sales = np.array([                                               │   │
│   │      [120, 85, 200, 150, 180, 95, 220],   # 1週目                 │   │
│   │      [100, 90, 180, 140, 200, 110, 190]   # 2週目                 │   │
│   │  ])                                                               │   │
│   │                                                                   │   │
│   │  print(f"全体の合計: {sales.sum()}")           # 2060             │   │
│   │  print(f"全体の平均: {sales.mean():.1f}")      # 147.1            │   │
│   │  print(f"週ごとの合計: {sales.sum(axis=1)}")   # [1050, 1010]     │   │
│   │  print(f"曜日ごとの平均: {sales.mean(axis=0)}")# [110, 87.5...]   │   │
│   │                                                                   │   │
│   │  # 150以上の高売上日を抽出                                        │   │
│   │  high_sales = sales[sales >= 150]                                 │   │
│   │  print(f"高売上: {high_sales}")   # [200 150 180 220 180 200 190] │   │
│   │  print(f"高売上日数: {len(high_sales)}日")     # 7日              │   │
│   └───────────────────────────────────────────────────────────────────┘   │
│                                                                           │
│   ポイント:                                                               │
│   ┌───────────────────────────────────────────────────────────────────┐   │
│   │                                                                   │   │
│   │   • axis=0: 列方向（縦）に集計 → 曜日ごとの値                    │   │
│   │   • axis=1: 行方向（横）に集計 → 週ごとの値                      │   │
│   │                                                                   │   │
│   │       axis=0                                                      │   │
│   │         ↓                                                        │   │
│   │      [120, 85, ...]  ──→ axis=1                                  │   │
│   │      [100, 90, ...]  ──→ axis=1                                  │   │
│   │                                                                   │   │
│   └───────────────────────────────────────────────────────────────────┘   │
│                                                                           │
│   💡 2次元配列 + 集計関数 + 条件抽出で、データ分析の基礎が完成！          │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘
```

---

## 💪 さあ、始めましょう！

NumPy は、Python でデータ分析を行うための「土台」です。
Excel では重くなってしまう大量データも、NumPy なら軽快に処理できます。

次の章で学ぶ Pandas は NumPy の上に構築されているので、
ここでしっかり配列操作をマスターしておきましょう！

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│     🚀 次のステップ: ch-overview.md で章の全体像を確認！        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
