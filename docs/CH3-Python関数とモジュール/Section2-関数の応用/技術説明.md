# Section2: 関数の応用

## 🎯 このセクションの目標

より柔軟で使いやすい関数を作成できるようになる

---

## 📚 学習内容

1. デフォルト引数
2. キーワード引数
3. 可変長引数（*args, **kwargs）
4. ラムダ式（lambda）
5. スコープ（ローカル変数とグローバル変数）

---

## 1. デフォルト引数

### デフォルト引数とは？

引数に初期値を設定することで、呼び出し時に省略できるようにする機能です。

### 基本的な使い方

```python
def greet(name, message="こんにちは"):
    print(message + "、" + name + "さん！")

# message を省略すると、デフォルト値が使われる
greet("田中")
greet("佐藤", "おはよう")
```

**出力:**
```
こんにちは、田中さん！
おはよう、佐藤さん！
```

### 実用例: 消費税計算

```python
def calc_price(price, tax_rate=0.10):
    """税込み価格を計算する（デフォルト税率 10%）"""
    return int(price * (1 + tax_rate))

print(calc_price(1000))         # 1100（10%）
print(calc_price(1000, 0.08))   # 1080（8%）
```

### ⚠️ 注意: デフォルト引数は後ろに置く

```python
# ❌ エラー: デフォルト引数の後に通常の引数は置けない
def greet(message="こんにちは", name):
    print(message + "、" + name)

# ⭕ 正しい: デフォルト引数は最後
def greet(name, message="こんにちは"):
    print(message + "、" + name)
```

---

## 2. キーワード引数

### キーワード引数とは？

引数を名前を指定して渡す方法です。
順番を気にせず、明確に値を渡せます。

### 基本的な使い方

```python
def create_profile(name, age, city):
    print("名前:", name)
    print("年齢:", age)
    print("都市:", city)

# 通常の呼び出し（順番通り）
create_profile("田中", 25, "東京")

# キーワード引数（順番自由）
create_profile(city="大阪", name="佐藤", age=30)
```

**出力:**
```
名前: 田中
年齢: 25
都市: 東京
名前: 佐藤
年齢: 30
都市: 大阪
```

### デフォルト引数と組み合わせ

```python
def send_email(to, subject="件名なし", body="本文なし"):
    print("To:", to)
    print("Subject:", subject)
    print("Body:", body)
    print("---")

# 必須の引数だけ指定
send_email("user@example.com")

# 一部のオプションだけ指定
send_email("user@example.com", body="こんにちは！")
```

**出力:**
```
To: user@example.com
Subject: 件名なし
Body: 本文なし
---
To: user@example.com
Subject: 件名なし
Body: こんにちは！
---
```

---

## 3. 可変長引数

### *args（位置引数の可変長）

任意の数の引数を受け取ることができます。

```python
def calc_sum(*numbers):
    """任意の数の合計を計算"""
    total = 0
    for num in numbers:
        total = total + num
    return total

print(calc_sum(1, 2))           # 3
print(calc_sum(1, 2, 3, 4, 5))  # 15
print(calc_sum(10))             # 10
```

### *args の仕組み

`*args` は渡された引数をタプル（tuple）として受け取ります。

```
┌─────────────────────────────────────────────────────────┐
│  関数呼び出し: calc_sum(1, 2, 3, 4, 5)                  │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│  def calc_sum(*numbers):                                │
│                                                         │
│    numbers = (1, 2, 3, 4, 5)  ← タプルとして受け取る   │
│              ─────────────                              │
│              1つの変数に全ての引数がまとまる            │
└─────────────────────────────────────────────────────────┘
```

```python
def show_args(*args):
    print("型:", type(args))
    print("中身:", args)

show_args(1, 2, 3)
```

**出力:**
```
型: <class 'tuple'>
中身: (1, 2, 3)
```

### **kwargs（キーワード引数の可変長）

任意の数のキーワード引数を受け取ることができます。

```python
def show_info(**kwargs):
    """任意のキーワード引数を表示"""
    for key, value in kwargs.items():
        print(key + ":", value)

show_info(name="田中", age=25, city="東京")
```

**出力:**
```
name: 田中
age: 25
city: 東京
```

### **kwargs の仕組み

`**kwargs` は渡された引数を辞書（dict）として受け取ります。

```
┌────────────────────────────────────────────────────────────┐
│  関数呼び出し: show_info(name="田中", age=25, city="東京") │
└────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌────────────────────────────────────────────────────────────┐
│  def show_info(**kwargs):                                  │
│                                                            │
│    kwargs = {                                              │
│        "name": "田中",    ← キーと値のペアで格納          │
│        "age": 25,                                          │
│        "city": "東京"                                      │
│    }                                                       │
└────────────────────────────────────────────────────────────┘
```

```python
def show_kwargs(**kwargs):
    print("型:", type(kwargs))
    print("中身:", kwargs)

show_kwargs(a=1, b=2)
```

**出力:**
```
型: <class 'dict'>
中身: {'a': 1, 'b': 2}
```

### *args と **kwargs の組み合わせ

```python
def flexible_function(*args, **kwargs):
    print("位置引数:", args)
    print("キーワード引数:", kwargs)

flexible_function(1, 2, 3, name="田中", age=25)
```

**出力:**
```
位置引数: (1, 2, 3)
キーワード引数: {'name': '田中', 'age': 25}
```

---

## 4. ラムダ式（lambda）

### ラムダ式とは？

1行で書ける小さな無名関数です。
簡単な処理を手軽に書きたいときに使います。

### 基本構文

```python
# 通常の関数
def add(a, b):
    return a + b

# ラムダ式
add = lambda a, b: a + b

# 使い方は同じ
print(add(3, 5))  # 8
```

### ラムダ式の構文

```
lambda 引数: 戻り値
```

### よく使う例

```python
# 2乗を計算
square = lambda x: x ** 2
print(square(5))  # 25

# 文字列を大文字に
upper = lambda s: s.upper()
print(upper("hello"))  # HELLO

# 2つの値の大きい方を返す
maximum = lambda a, b: a if a > b else b
print(maximum(10, 20))  # 20
```

### リストのソートでの活用

ラムダ式は `sorted()` や `sort()` でよく使われます。

```python
# 辞書のリストを年齢でソート
people = [
    {"name": "田中", "age": 25},
    {"name": "佐藤", "age": 30},
    {"name": "鈴木", "age": 20}
]

# age をキーにしてソート
sorted_people = sorted(people, key=lambda x: x["age"])

for person in sorted_people:
    print(person["name"], person["age"])
```

**出力:**
```
鈴木 20
田中 25
佐藤 30
```

### map() と filter() での活用

#### map() の仕組み

`map()` は各要素に関数を適用して、新しいリストを作ります。

```
┌─────────────────────────────────────────────────────────┐
│  map(lambda x: x * 2, [1, 2, 3, 4, 5])                  │
└─────────────────────────────────────────────────────────┘

   入力リスト          変換関数           出力リスト
   ┌───┐               ┌───────┐            ┌───┐
   │ 1 │  ──────────▶ │ × 2   │ ────────▶ │ 2 │
   ├───┤               ├───────┤            ├───┤
   │ 2 │  ──────────▶ │ × 2   │ ────────▶ │ 4 │
   ├───┤               ├───────┤            ├───┤
   │ 3 │  ──────────▶ │ × 2   │ ────────▶ │ 6 │
   ├───┤               ├───────┤            ├───┤
   │ 4 │  ──────────▶ │ × 2   │ ────────▶ │ 8 │
   ├───┤               ├───────┤            ├───┤
   │ 5 │  ──────────▶ │ × 2   │ ────────▶ │10 │
   └───┘               └───────┘            └───┘
```

#### filter() の仕組み

`filter()` は条件に合う要素だけを残します。

```
┌─────────────────────────────────────────────────────────┐
│  filter(lambda x: x % 2 == 0, [1, 2, 3, 4, 5])          │
└─────────────────────────────────────────────────────────┘

   入力リスト          条件判定           出力リスト
   ┌───┐               ┌───────┐           
   │ 1 │  ──────────▶ │偶数？ │ ─▶ ✗ 除外
   ├───┤               ├───────┤              ┌───┐
   │ 2 │  ──────────▶ │偶数？ │ ─▶ ✓ ───▶ │ 2 │
   ├───┤               ├───────┤              └───┘
   │ 3 │  ──────────▶ │偶数？ │ ─▶ ✗ 除外
   ├───┤               ├───────┤              ┌───┐
   │ 4 │  ──────────▶ │偶数？ │ ─▶ ✓ ───▶ │ 4 │
   ├───┤               ├───────┤              └───┘
   │ 5 │  ──────────▶ │偶数？ │ ─▶ ✗ 除外
   └───┘               └───────┘           
```

```python
numbers = [1, 2, 3, 4, 5]

# 各要素を2倍（map）
doubled = list(map(lambda x: x * 2, numbers))
print(doubled)  # [2, 4, 6, 8, 10]

# 偶数だけ抽出（filter）
evens = list(filter(lambda x: x % 2 == 0, numbers))
print(evens)  # [2, 4]
```

---

## 5. スコープ

### スコープとは？

変数が使える範囲のことです。
関数内で定義した変数は、関数の外からは使えません。

### ローカル変数

関数内で定義した変数は「ローカル変数」です。

```python
def my_function():
    x = 10  # ローカル変数
    print("関数内:", x)

my_function()
# print(x)  # エラー！関数の外からは使えない
```

### グローバル変数

関数の外で定義した変数は「グローバル変数」です。

```python
message = "Hello"  # グローバル変数

def greet():
    print(message)  # グローバル変数を参照できる

greet()  # Hello
```

### 同じ名前の変数がある場合

```python
x = 100  # グローバル変数

def my_function():
    x = 10  # ローカル変数（別の変数）
    print("関数内:", x)

my_function()      # 関数内: 10
print("関数外:", x)  # 関数外: 100
```

### global キーワード

関数内からグローバル変数を変更したい場合は `global` を使います。

```python
count = 0

def increment():
    global count
    count = count + 1

increment()
increment()
increment()
print(count)  # 3
```

### ⚠️ global の使用は最小限に

`global` を多用するとコードが複雑になります。
できるだけ引数と戻り値を使いましょう。

```python
# ⭕ 推奨: 引数と戻り値を使う
def increment(count):
    return count + 1

count = 0
count = increment(count)
count = increment(count)
print(count)  # 2
```

---

## 6. 実践例: 引数の活用

### 例1: 柔軟なログ関数

```python
def log(message, level="INFO", timestamp=True):
    """ログメッセージを出力する"""
    output = ""
    
    if timestamp:
        output = "[2024-01-15 10:30:00] "
    
    output = output + "[" + level + "] " + message
    print(output)

log("処理を開始")
log("警告があります", level="WARNING")
log("デバッグ情報", level="DEBUG", timestamp=False)
```

**出力:**
```
[2024-01-15 10:30:00] [INFO] 処理を開始
[2024-01-15 10:30:00] [WARNING] 警告があります
[DEBUG] デバッグ情報
```

### 例2: 複数の値を処理

```python
def calc_stats(*values):
    """複数の値の統計を計算"""
    if len(values) == 0:
        return None, None, None
    
    min_val = min(values)
    max_val = max(values)
    avg_val = sum(values) / len(values)
    
    return min_val, max_val, avg_val

minimum, maximum, average = calc_stats(10, 20, 30, 40, 50)
print("最小:", minimum)  # 最小: 10
print("最大:", maximum)  # 最大: 50
print("平均:", average)  # 平均: 30.0
```

### 例3: 設定オプション

```python
def connect_database(**options):
    """データベース接続オプションを表示"""
    # デフォルト値を設定
    host = options.get("host", "localhost")
    port = options.get("port", 3306)
    user = options.get("user", "root")
    
    print("接続先:", host + ":" + str(port))
    print("ユーザー:", user)

connect_database()
connect_database(host="192.168.1.100", user="admin")
```

**出力:**
```
接続先: localhost:3306
ユーザー: root
接続先: 192.168.1.100:3306
ユーザー: admin
```

---

## 📝 まとめ

| 概念 | 説明 | 例 |
|------|------|-----|
| デフォルト引数 | 引数の初期値を設定 | `def f(x=10):` |
| キーワード引数 | 名前で引数を指定 | `f(name="田中")` |
| *args | 可変長の位置引数 | `def f(*args):` |
| **kwargs | 可変長のキーワード引数 | `def f(**kwargs):` |
| lambda | 無名関数 | `lambda x: x * 2` |
| スコープ | 変数の有効範囲 | ローカル/グローバル |

---

## 🚀 次のステップ

演習.md に進んで、これらの機能を実際に使ってみましょう！
