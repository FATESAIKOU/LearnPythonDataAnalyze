# Section2: ミニプロジェクト① 売上分析 - 演習

## 🎯 この演習の目標

tips データセットを使って、レストランの売上分析プロジェクトを完成させる。

---

## 📋 プロジェクトの進め方

ミニ分析プロセスの5ステップに沿って進めます：

1. **問いを立てる** → 何を知りたいか決める
2. **データを見る** → head/info/describe で確認
3. **データを整える** → 必要な加工を行う
4. **集計・可視化する** → 分析を実行
5. **結論をまとめる** → レポートを作成

---

## 📝 Step 1: 問いを立てる

以下の問いに答える分析を行います（追加の問いを考えても OK）：

1. **曜日によって売上に差はあるか？**
2. **ランチとディナーで客単価に違いはあるか？**
3. **人数と合計金額にはどんな関係があるか？**
4. **売上を伸ばすにはどうすればよいか？**

```python
# Jupyter の Markdown セルにメモしておきましょう

# 分析の問い:
# 1. 曜日によって売上に差はあるか？
# 2. ランチとディナーで客単価に違いはあるか？
# 3. 人数と合計金額にはどんな関係があるか？
# 4. 売上を伸ばすにはどうすればよいか？
```

---

## 📝 Step 2: データを見る

### 課題2-1: データの読み込みと確認

```python
# ライブラリのインポート
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# tips データセットの読み込み
df = sns.load_dataset('tips')

# 先頭5行を表示
df.head()
```

```python
# データの基本情報
df.info()
```

```python
# 統計量
df.describe()
```

```python
# データのサイズ
print(f"行数: {df.shape[0]}, 列数: {df.shape[1]}")
```

### 確認ポイント

- [ ] データは何行何列か？
- [ ] 欠損値はあるか？
- [ ] 合計金額（total_bill）の平均・最大・最小は？
- [ ] 曜日（day）にはどんな値があるか？

<details>
<summary>💡 確認結果</summary>

- **244行、7列**
- **欠損値なし**
- total_bill: 平均 $19.79、最大 $50.81、最小 $3.07
- day: Thur（木）, Fri（金）, Sat（土）, Sun（日）

```python
# 曜日の値を確認
print(df['day'].unique())
```

</details>

---

## 📝 Step 3: データを整える

### 課題3-1: チップ率の列を追加

分析に役立つ「チップ率」の列を追加しましょう。

```python
# チップ率（%）を計算して新しい列を追加
df['tip_rate'] = # ここにコードを書く

# 結果を確認
df.head()
```

<details>
<summary>💡 ヒントを見る</summary>

チップ率 = チップ ÷ 合計金額 × 100

```python
df['tip_rate'] = df['tip'] / df['total_bill'] * 100
```

</details>

<details>
<summary>💡 解答を見る</summary>

```python
# チップ率（%）を計算して新しい列を追加
df['tip_rate'] = df['tip'] / df['total_bill'] * 100

# 結果を確認
df.head()
```

tip_rate 列が追加され、各レコードのチップ率が計算されます。

</details>

---

## 📝 Step 4: 集計・可視化する

### 課題4-1: 曜日別の売上分析

#### 4-1-1: 曜日別の合計売上を計算

```python
# 曜日別の合計売上
daily_sales = # ここにコードを書く
print(daily_sales)
```

<details>
<summary>💡 ヒントを見る</summary>

```python
df.groupby('day')['total_bill'].sum()
```

</details>

<details>
<summary>💡 解答を見る</summary>

```python
# 曜日別の合計売上
daily_sales = df.groupby('day')['total_bill'].sum()
print(daily_sales)
```

結果:
```
day
Thur    1096.33
Fri      325.88
Sat     1778.40
Sun     1627.16
Name: total_bill, dtype: float64
```

土曜日の売上が最も高いことがわかります。

</details>

#### 4-1-2: 曜日別の平均客単価を計算

```python
# 曜日別の平均客単価
daily_avg = # ここにコードを書く
print(daily_avg)
```

<details>
<summary>💡 解答を見る</summary>

```python
# 曜日別の平均客単価
daily_avg = df.groupby('day')['total_bill'].mean()
print(daily_avg)
```

結果:
```
day
Thur    17.682742
Fri     17.151579
Sat     20.441379
Sun     21.410000
Name: total_bill, dtype: float64
```

日曜日の客単価が最も高いことがわかります。

</details>

#### 4-1-3: 曜日別の来客数をカウント

```python
# 曜日別の来客数（レコード数）
daily_count = # ここにコードを書く
print(daily_count)
```

<details>
<summary>💡 解答を見る</summary>

```python
# 曜日別の来客数（レコード数）
daily_count = df.groupby('day')['total_bill'].count()
print(daily_count)
```

結果:
```
day
Thur    62
Fri     19
Sat     87
Sun     76
Name: total_bill, dtype: int64
```

土曜日の来客数が最も多いことがわかります。

</details>

#### 4-1-4: 曜日別の売上を棒グラフで可視化

```python
# 曜日別の合計売上を棒グラフで表示
daily_sales = df.groupby('day')['total_bill'].sum()

plt.figure(figsize=(8, 5))
# ここにコードを書く（棒グラフ）

plt.title('Total Sales by Day')
plt.xlabel('Day')
plt.ylabel('Total Sales ($)')
plt.xticks(rotation=0)
plt.tight_layout()
plt.show()
```

<details>
<summary>💡 解答を見る</summary>

```python
# 曜日別の合計売上を棒グラフで表示
daily_sales = df.groupby('day')['total_bill'].sum()

plt.figure(figsize=(8, 5))
daily_sales.plot(kind='bar', color='steelblue')
plt.title('Total Sales by Day')
plt.xlabel('Day')
plt.ylabel('Total Sales ($)')
plt.xticks(rotation=0)
plt.tight_layout()
plt.show()
```

</details>

---

### 課題4-2: 時間帯別の分析

#### 4-2-1: ランチとディナーの平均客単価を比較

```python
# 時間帯別の平均客単価
time_avg = # ここにコードを書く
print(time_avg)
```

<details>
<summary>💡 解答を見る</summary>

```python
# 時間帯別の平均客単価
time_avg = df.groupby('time')['total_bill'].mean()
print(time_avg)
```

結果:
```
time
Lunch     17.168676
Dinner    20.797159
Name: total_bill, dtype: float64
```

ディナーの方が客単価が約 $3.6 高いことがわかります。

</details>

#### 4-2-2: 曜日 × 時間帯 のクロス集計

```python
# 曜日 × 時間帯 の平均客単価
cross_table = df.groupby(['day', 'time'])['total_bill'].mean().unstack()
print(cross_table)
```

```python
# クロス集計を棒グラフで可視化
cross_table.plot(kind='bar', figsize=(10, 5))
plt.title('Average Sales by Day and Time')
plt.xlabel('Day')
plt.ylabel('Average Total Bill ($)')
plt.xticks(rotation=0)
plt.legend(title='Time')
plt.tight_layout()
plt.show()
```

<details>
<summary>💡 解説</summary>

このグラフから以下のことがわかります：
- 土曜・日曜はディナーのみ営業している
- 平日のランチは客単価が低め
- 日曜ディナーの客単価が最も高い

</details>

---

### 課題4-3: 人数と売上の関係

#### 4-3-1: 人数と合計金額の散布図

```python
# 人数と合計金額の散布図
plt.figure(figsize=(8, 5))
# ここにコードを書く

plt.title('Party Size vs Total Bill')
plt.xlabel('Party Size')
plt.ylabel('Total Bill ($)')
plt.tight_layout()
plt.show()
```

<details>
<summary>💡 解答を見る</summary>

```python
# 人数と合計金額の散布図
plt.figure(figsize=(8, 5))
plt.scatter(df['size'], df['total_bill'], alpha=0.6, color='steelblue')
plt.title('Party Size vs Total Bill')
plt.xlabel('Party Size')
plt.ylabel('Total Bill ($)')
plt.tight_layout()
plt.show()
```

</details>

#### 4-3-2: 相関係数を計算

```python
# 人数と合計金額の相関係数
correlation = # ここにコードを書く
print(f"相関係数: {correlation:.3f}")
```

<details>
<summary>💡 ヒントを見る</summary>

```python
df['列1'].corr(df['列2'])
```

</details>

<details>
<summary>💡 解答を見る</summary>

```python
# 人数と合計金額の相関係数
correlation = df['size'].corr(df['total_bill'])
print(f"相関係数: {correlation:.3f}")
```

結果: **相関係数: 0.598**

中程度の正の相関があります。人数が多いほど合計金額が高くなる傾向があります。

</details>

#### 4-3-3: 人数別の平均客単価

```python
# 人数別の平均客単価
size_avg = df.groupby('size')['total_bill'].mean()
print(size_avg)

# 棒グラフで可視化
plt.figure(figsize=(8, 5))
size_avg.plot(kind='bar', color='coral')
plt.title('Average Total Bill by Party Size')
plt.xlabel('Party Size')
plt.ylabel('Average Total Bill ($)')
plt.xticks(rotation=0)
plt.tight_layout()
plt.show()
```

---

### 課題4-4: チップ率の分析（追加分析）

#### 4-4-1: チップ率の分布を確認

```python
# チップ率のヒストグラム
plt.figure(figsize=(8, 5))
plt.hist(df['tip_rate'], bins=20, color='seagreen', edgecolor='white')
plt.title('Distribution of Tip Rate')
plt.xlabel('Tip Rate (%)')
plt.ylabel('Frequency')
plt.tight_layout()
plt.show()

# 統計量
print(df['tip_rate'].describe())
```

#### 4-4-2: 条件別のチップ率を比較

```python
# 時間帯別のチップ率
print("=== 時間帯別 ===")
print(df.groupby('time')['tip_rate'].mean())

# 喫煙者・非喫煙者別
print("\n=== 喫煙者別 ===")
print(df.groupby('smoker')['tip_rate'].mean())
```

---

## 📝 Step 5: 結論をまとめる

### 課題5: 分析レポートを作成

以下のテンプレートに沿って、分析レポートを作成してください。

```markdown
# 売上分析レポート

## 1. 分析の目的
レストランの売上データを分析し、売上向上のためのヒントを得る。

## 2. 使用データ
- データセット: tips（seaborn 組み込み）
- レコード数: 244件

## 3. 分析結果

### 3.1 曜日別の売上傾向
（ここに結果と発見を書く）

### 3.2 時間帯別の客単価
（ここに結果と発見を書く）

### 3.3 人数と売上の関係
（ここに結果と発見を書く）

## 4. 考察・提案
（分析結果に基づく具体的な提案を書く）
```

<details>
<summary>💡 レポート例を見る</summary>

```markdown
# 売上分析レポート

## 1. 分析の目的
レストランの売上データを分析し、売上向上のためのヒントを得る。

## 2. 使用データ
- データセット: tips（seaborn 組み込み）
- レコード数: 244件

## 3. 分析結果

### 3.1 曜日別の売上傾向
- **合計売上**: 土曜日が最高（$1,778）、金曜日が最低（$326）
- **来客数**: 土曜日が最多（87組）、金曜日が最少（19組）
- **客単価**: 日曜日が最高（$21.41）、金曜日が最低（$17.15）

**発見**: 週末（土・日）に売上が集中している。

### 3.2 時間帯別の客単価
- **ディナー**: 平均 $20.80
- **ランチ**: 平均 $17.17

**発見**: ディナーの客単価はランチより約 21% 高い。

### 3.3 人数と売上の関係
- **相関係数**: 0.598（中程度の正の相関）
- 人数が多いほど合計金額が高くなる傾向

**発見**: グループ客の獲得が売上向上に効果的。

## 4. 考察・提案

### 提案1: 週末の座席効率を上げる
土曜日は来客数が最多だが、客単価は日曜日より低い。
週末の回転率を上げるか、客単価を上げるメニュー施策が有効。

### 提案2: 金曜日の集客強化
金曜日は来客数・売上ともに最低。
金曜限定のプロモーションやハッピーアワーの導入を検討。

### 提案3: グループ向けプランの充実
人数と売上に正の相関があるため、グループ向けコースやパーティプランを
強化することで客単価向上が期待できる。
```

</details>

---

## ✅ 演習の完了チェック

以下の項目ができたら、この演習は完了です：

- [ ] tips データセットを読み込み、内容を確認した
- [ ] チップ率の列を追加した
- [ ] 曜日別の売上（合計・平均・件数）を集計した
- [ ] 曜日別の売上を棒グラフで可視化した
- [ ] 時間帯別の客単価を比較した
- [ ] 人数と合計金額の散布図を作成した
- [ ] 相関係数を計算した
- [ ] 分析レポートを作成した

---

次は「応用問題」で、追加の分析課題に挑戦します！
