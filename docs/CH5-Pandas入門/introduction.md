# CH5: Pandas 入門 - 学習の動機づけ

## 🎯 なぜ Pandas を学ぶのか？

Excel で日常的にデータを扱っていませんか？
「CSV ファイルを開いて、フィルタリングして、必要な列だけ取り出して...」という作業を繰り返していませんか？

Pandas を学ぶことで、**Excel のような表データ操作をプログラムで実行** できるようになります。
しかも、より高速に、より柔軟に、より再現性高く処理できます。

```
┌─────────────────────────────────────────────────────────────────┐
│                  Pandas を学ぶ目的                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   📊 Excel 感覚でデータ操作  →  表形式データを直感的に扱える    │
│                                                                 │
│   📁 ファイル読み書きが簡単  →  CSV/Excel を1行で読み込める     │
│                                                                 │
│   🔍 強力なフィルタリング    →  複雑な条件抽出も簡潔に書ける    │
│                                                                 │
│   🔄 再現性のあるデータ処理  →  同じ処理を何度でも自動実行      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔑 この章を学ぶための前提条件

```
┌─────────────────────────────────────────────────────────────────┐
│                      学習の前提条件                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ✅ 条件 1: CH1-CH4 の内容を理解している                        │
│     ─────────────────────────────────────────────────           │
│     • Python の基礎文法が使える                                 │
│     • NumPy 配列の基本操作ができる                              │
│     • インデックスとスライスの概念がわかる                      │
│                                                                 │
│  ✅ 条件 2: Excel で表データを扱った経験がある                  │
│     ─────────────────────────────────────────────────           │
│     • 行と列の概念がわかる                                      │
│     • フィルター機能を使ったことがある                          │
│     • ソート、列の追加などの操作ができる                        │
│                                                                 │
│  ✅ 条件 3: CSV ファイルを見たことがある                        │
│     ─────────────────────────────────────────────────           │
│     • 「カンマ区切りのテキストファイル」という認識がある        │
│     • Excel で CSV を開いたことがある                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 この章を学ぶと何が変わるのか？（As-Is / To-Be 比較）

### 変化1: CSV ファイルの読み込みが1行で完了

**シナリオ**: 売上データの CSV ファイルを開いて確認したい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   手順:                                                                 │
│   ┌────────────────────────────────────────────────────────────────┐    │
│   │  ① Excel を起動                                               │    │
│   │  ② [ファイル] → [開く] → ファイルを選択                     │    │
│   │  ③ テキストインポートウィザードが表示される                   │    │
│   │  ④ 区切り文字を選択（カンマ）                                 │    │
│   │  ⑤ 各列のデータ形式を設定                                     │    │
│   │  ⑥ [完了] をクリック                                          │    │
│   │  ⑦ 文字化けしていたらエンコード設定をやり直し...              │    │
│   └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│   😰 問題点:                                                            │
│   • 手順が多い                                                          │
│   • 文字化け対応が面倒                                                  │
│   • 毎回同じ設定をする必要がある                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: Pandas の場合                                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  import pandas as pd                                            │   │
│   │                                                                 │   │
│   │  # CSVを読み込む（1行！）                                       │   │
│   │  df = pd.read_csv("sales.csv", encoding="utf-8")                │   │
│   │                                                                 │   │
│   │  # 先頭5行を確認                                                │   │
│   │  df.head()                                                      │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   出力:                                                                 │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │       日付      支店    商品     売上                           │   │
│   │  0   2024-01-01  東京   りんご    120                           │   │
│   │  1   2024-01-01  大阪   みかん     85                           │   │
│   │  2   2024-01-02  東京   バナナ    200                           │   │
│   │  3   2024-01-02  名古屋  りんご   150                           │   │
│   │  4   2024-01-03  東京   みかん    180                           │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 1行でファイル読み込み完了                                           │
│   • エンコード指定も引数で簡単                                          │
│   • 設定をコードに保存しておけば再利用可能                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 変化2: 必要なデータの選択が直感的にできる

**シナリオ**: 「東京支店」の「売上」列だけを取り出したい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   方法1: フィルターを使う                                               │
│   ┌────────────────────────────────────────────────────────────────┐    │
│   │  ① 支店列のフィルターで「東京」だけを選択                     │    │
│   │  ② 表示された行をコピー                                       │    │
│   │  ③ 新しいシートに貼り付け                                     │    │
│   │  ④ 不要な列を削除                                             │    │
│   └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│   方法2: 関数を使う                                                     │
│   ┌────────────────────────────────────────────────────────────────┐    │
│   │  =IF(B2="東京", D2, "")                                        │    │
│   │  → 空白セルが残る問題...                                       │    │
│   │  → FILTER関数は新しいExcelのみ対応                             │    │
│   └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│   😰 問題点:                                                            │
│   • 手順が多く、ミスしやすい                                            │
│   • 元データを変更してしまうリスク                                      │
│   • 条件を変えるたびに作業をやり直す必要がある                          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: Pandas の場合                                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  # 東京支店のデータだけを抽出                                   │   │
│   │  tokyo_data = df[df["支店"] == "東京"]                          │   │
│   │                                                                 │   │
│   │  # さらに売上列だけを取得                                       │   │
│   │  tokyo_sales = df.loc[df["支店"] == "東京", "売上"]             │   │
│   │                                                                 │   │
│   │  print(tokyo_sales)                                             │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   出力:                                                                 │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  0    120                                                       │   │
│   │  2    200                                                       │   │
│   │  4    180                                                       │   │
│   │  Name: 売上, dtype: int64                                       │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 1〜2行で条件抽出 + 列選択が完了                                     │
│   • 元データは変更されない（新しいデータが作られる）                    │
│   • 条件を変えるのも簡単（"東京" → "大阪" に変えるだけ）                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

### 変化3: データの概要把握が一瞬でできる

**シナリオ**: データの全体像（行数、列数、データ型、統計情報）を確認したい

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📊 As-Is: Excel の場合                                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   確認したい情報と確認方法:                                             │
│   ┌────────────────────────────────────────────────────────────────┐    │
│   │  • 行数   → 最終行までスクロール or Ctrl+End                   │    │
│   │  • 列数   → 列を数える                                         │    │
│   │  • 合計   → =SUM(列範囲) を入力                                │    │
│   │  • 平均   → =AVERAGE(列範囲) を入力                            │    │
│   │  • 最大   → =MAX(列範囲) を入力                                │    │
│   │  • 最小   → =MIN(列範囲) を入力                                │    │
│   │  • 欠損値 → 目視確認 or COUNTBLANK関数                         │    │
│   └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│   😰 問題点:                                                            │
│   • 複数の操作が必要                                                    │
│   • 列ごとに関数を入力する必要がある                                    │
│   • 大きなデータだと時間がかかる                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  🐍 To-Be: Pandas の場合                                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  # データの基本情報を確認                                       │   │
│   │  print(df.shape)    # → (1000, 4)  # 1000行×4列                 │   │
│   │  print(df.info())   # 各列のデータ型と欠損値の数                │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  # 統計情報を一括表示                                           │   │
│   │  df.describe()                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   出力:                                                                 │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │              売上                                               │   │
│   │  count   1000.000000    ← データ数                              │   │
│   │  mean     156.500000    ← 平均                                  │   │
│   │  std       45.123456    ← 標準偏差                              │   │
│   │  min       45.000000    ← 最小値                                │   │
│   │  25%      120.000000    ← 第1四分位数                           │   │
│   │  50%      155.000000    ← 中央値                                │   │
│   │  75%      190.000000    ← 第3四分位数                           │   │
│   │  max      280.000000    ← 最大値                                │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   😊 利点:                                                              │
│   • 1行のコマンドで全統計情報が表示される                               │
│   • 全ての数値列に対して自動で計算される                                │
│   • 欠損値の数も info() で一目瞭然                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📚 この章で学ぶ内容

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       CH5 の学習内容                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Section 1-2: Series と DataFrame                                       │
│  ────────────────────────────────                                       │
│  • Pandas の2つのデータ構造を理解する                                   │
│                                                                         │
│      Series (1次元):           DataFrame (2次元):                       │
│      ┌───────────┐             ┌───────┬───────┬───────┐                │
│      │  index    │             │       │ 列A   │ 列B   │                │
│      ├───────────┤             ├───────┼───────┼───────┤                │
│      │  0 │ 100  │             │ 行0   │  100  │  200  │                │
│      │  1 │ 200  │             │ 行1   │  150  │  250  │                │
│      │  2 │ 150  │             │ 行2   │  180  │  220  │                │
│      └───────────┘             └───────┴───────┴───────┘                │
│                                                                         │
│      Excel の「1列」に相当       Excel の「表全体」に相当               │
│                                                                         │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                         │
│  Section 3: データの読み書き                                            │
│  ────────────────────────────                                           │
│  • ファイルからデータを読み込み、保存する                               │
│                                                                         │
│      ┌────────────────────────────────────────────────────────────┐     │
│      │  # 読み込み                                                │     │
│      │  df = pd.read_csv("data.csv")                              │     │
│      │  df = pd.read_excel("data.xlsx")                           │     │
│      │                                                            │     │
│      │  # 保存                                                    │     │
│      │  df.to_csv("output.csv", index=False)                      │     │
│      │  df.to_excel("output.xlsx", index=False)                   │     │
│      └────────────────────────────────────────────────────────────┘     │
│                                                                         │
│  ─────────────────────────────────────────────────────────────────────  │
│                                                                         │
│  Section 4-5: データの選択とフィルタリング                              │
│  ────────────────────────────────                                       │
│  • 必要なデータだけを取り出す                                           │
│                                                                         │
│      ┌────────────────────────────────────────────────────────────┐     │
│      │  # 列を選択                                                │     │
│      │  df["売上"]              # 1列を取得 → Series              │     │
│      │  df[["日付", "売上"]]    # 複数列を取得 → DataFrame        │     │
│      │                                                            │     │
│      │  # 条件でフィルタリング                                    │     │
│      │  df[df["売上"] >= 100]   # 売上100以上の行                 │     │
│      │  df[(df["支店"]=="東京") & (df["売上"]>=100)]  # 複合条件  │     │
│      └────────────────────────────────────────────────────────────┘     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🏁 この章のゴール

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        CH5 修了時の姿                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  # この章を修了すると、このコードが「書ける」ようになります     │   │
│   │                                                                 │   │
│   │  import pandas as pd                                            │   │
│   │                                                                 │   │
│   │  # 1. データを読み込む                                          │   │
│   │  df = pd.read_csv("sales.csv", encoding="utf-8")                │   │
│   │                                                                 │   │
│   │  # 2. データの概要を確認                                        │   │
│   │  print(f"データサイズ: {df.shape[0]}行 × {df.shape[1]}列")      │   │
│   │  print(df.head())                                               │   │
│   │  print(df.describe())                                           │   │
│   │                                                                 │   │
│   │  # 3. 東京支店の売上150以上のデータを抽出                       │   │
│   │  filtered = df[(df["支店"] == "東京") & (df["売上"] >= 150)]    │   │
│   │  print(f"該当件数: {len(filtered)}件")                          │   │
│   │                                                                 │   │
│   │  # 4. 結果を保存                                                │   │
│   │  filtered.to_csv("tokyo_high_sales.csv", index=False)           │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   処理の流れ:                                                           │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                 │   │
│   │   ┌──────────┐    ┌─────────┐    ┌──────────┐    ┌─────────┐    │   │
│   │   │  CSV     │ →  │  読込   │ →  │ フィルタ │ →  │  保存   │    │   │
│   │   │ ファイル │    │ read_csv│    │  抽出    │    │ to_csv  │    │   │
│   │   └──────────┘    └─────────┘    └──────────┘    └─────────┘    │   │
│   │                                                                 │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   💡 ファイル読込 → 確認 → 抽出 → 保存、これがデータ処理の基本！        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 💪 さあ、始めましょう！

Pandas を学べば、Excel でやっていた作業の多くをプログラムで実行できるようになります。
しかも、より高速に、より正確に、何度でも再現できる形で処理できます。

この章は「データ分析の本番」への入り口です。
しっかりマスターして、次の CH6 でさらに高度なデータ操作に進みましょう！

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│     🚀 次のステップ: ch-overview.md で章の全体像を確認！        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
