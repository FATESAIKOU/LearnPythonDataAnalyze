# Section3: データの読み書き

## 🎯 このセクションで学ぶこと

実際のデータ分析では、CSV や Excel ファイルからデータを読み込み、
分析結果をファイルに保存することが日常的に行われます。

このセクションでは、Pandas でファイルを扱う方法を学びます。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       データの読み書きフロー                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【外部ファイル】              【Python/Pandas】            【出力】   │
│                                                                         │
│   ┌──────────────┐              ┌──────────────┐          ┌───────────┐ │
│   │  📁 CSV      │──read_csv──→ │              │          │ 📁 CSV    │ │
│   │  data.csv    │              │  DataFrame   │─to_csv─→ │ out.csv   │ │
│   └──────────────┘              │              │          └───────────┘ │
│                                 │  ┌────────┐  │                        │
│   ┌──────────────┐              │  │  加工  │  │          ┌───────────┐ │
│   │  📊 Excel    │─read_excel─→ │  │  分析  │  │─to_excel→│ 📊 Excel  │ │
│   │  data.xlsx   │              │  │  集計  │  │          │ out.xlsx  │ │
│   └──────────────┘              │  └────────┘  │          └───────────┘ │
│                                 │              │                        │
│                                 └──────────────┘                        │
│                                                                         │
│   😊 Pandas を使えば、読み込み → 加工 → 保存 が簡単にできる！           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 1. CSVファイルの読み込み（read_csv）

### 1.1 CSV とは？

CSV（Comma-Separated Values）は、カンマで区切られたテキストファイルです。
Excel やスプレッドシートでも開ける、最も一般的なデータ形式です。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         CSV ファイルの構造                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【data.csv の中身（テキスト）】        【表として見ると】             │
│                                                                         │
│   ┌──────────────────────────┐          ┌──────┬───────┬───────┐        │
│   │ 名前,年齢,都市           │          │ 名前 │ 年齢  │ 都市  │        │
│   │ 田中,25,東京             │    ═══>  ├──────┼───────┼───────┤        │
│   │ 佐藤,30,大阪             │          │ 田中 │  25   │ 東京  │        │
│   │ 鈴木,28,福岡             │          │ 佐藤 │  30   │ 大阪  │        │
│   └──────────────────────────┘          │ 鈴木 │  28   │ 福岡  │        │
│         ↑                               └──────┴───────┴───────┘        │
│         カンマ(,)で区切られている                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 基本的な読み込み

```python
import pandas as pd

# CSVファイルを読み込む
df = pd.read_csv("data.csv")

# 読み込んだデータを確認
print(df)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      read_csv の動作イメージ                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   pd.read_csv("data.csv")                                               │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  1. ファイルを開く                                              │   │
│   │  2. 1行目をカラム名（列名）として認識                           │   │
│   │  3. 2行目以降をデータとして読み込む                             │   │
│   │  4. 行番号（インデックス）を自動で付ける: 0, 1, 2, ...          │   │
│   │  5. DataFrame として返す                                        │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │       名前   年齢   都市                                        │   │
│   │    0  田中    25    東京   ← インデックス 0 から開始            │   │
│   │    1  佐藤    30    大阪                                        │   │
│   │    2  鈴木    28    福岡                                        │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 よく使うオプション

```python
# 文字コード指定（日本語ファイルで重要）
df = pd.read_csv("data.csv", encoding="utf-8")
df = pd.read_csv("data.csv", encoding="shift-jis")  # Windows で作成したファイル

# ヘッダーがないファイルの場合
df = pd.read_csv("data.csv", header=None)

# 特定の列をインデックスに設定
df = pd.read_csv("data.csv", index_col="名前")

# 読み込む行数を制限（大きいファイルの確認用）
df = pd.read_csv("data.csv", nrows=100)  # 先頭100行だけ読む
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      read_csv オプション早見表                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   オプション        効果                      使用例                    │
│   ──────────────────────────────────────────────────────────────────    │
│   encoding         文字コード指定             encoding="shift-jis"      │
│   header           ヘッダー行の指定           header=None (ヘッダーなし)│
│   index_col        インデックスにする列       index_col="名前"          │
│   nrows            読み込む行数               nrows=100                 │
│   usecols          読み込む列を指定           usecols=["名前", "年齢"]  │
│   skiprows         スキップする行数           skiprows=2                │
│   na_values        欠損値として扱う値         na_values=["", "N/A"]     │
│                                                                         │
│   💡 日本語CSVでエラーが出たら、まず encoding を試してみよう！          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 2. Excelファイルの読み込み（read_excel）

### 2.1 基本的な読み込み

```python
import pandas as pd

# Excelファイルを読み込む
df = pd.read_excel("data.xlsx")

# 読み込んだデータを確認
print(df)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     read_excel の動作イメージ                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【Excelファイル data.xlsx】                                           │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  📊 data.xlsx                                                   │   │
│   │  ┌─────────┬─────────┬─────────┐                                │   │
│   │  │ Sheet1  │ Sheet2  │ Sheet3  │  ← 複数シートがある場合        │   │
│   │  └─────────┴─────────┴─────────┘                                │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼  デフォルトでは最初のシート（Sheet1）を読み込む               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  pd.read_excel("data.xlsx")                                     │   │
│   │  → Sheet1 の内容が DataFrame になる                             │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 シートを指定して読み込む

```python
# シート名で指定
df = pd.read_excel("data.xlsx", sheet_name="売上データ")

# シート番号で指定（0から始まる）
df = pd.read_excel("data.xlsx", sheet_name=0)  # 最初のシート
df = pd.read_excel("data.xlsx", sheet_name=1)  # 2番目のシート

# 全シートを読み込む（辞書として返される）
all_sheets = pd.read_excel("data.xlsx", sheet_name=None)
print(all_sheets.keys())  # シート名の一覧
df_sheet1 = all_sheets["Sheet1"]  # 特定のシートにアクセス
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      複数シートの読み込み                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   pd.read_excel("data.xlsx", sheet_name=None)                           │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  all_sheets = {                                                 │   │
│   │      "Sheet1": DataFrame(...),  ← 各シートが DataFrame に       │   │
│   │      "売上":   DataFrame(...),                                  │   │
│   │      "顧客":   DataFrame(...)                                   │   │
│   │  }                                                              │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼  使いたいシートを取り出す                                     │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df_sales = all_sheets["売上"]                                  │   │
│   │  df_customer = all_sheets["顧客"]                               │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 3. CSVファイルへの保存（to_csv）

### 3.1 基本的な保存

```python
import pandas as pd

# サンプルデータ
df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木"],
    "年齢": [25, 30, 28],
    "都市": ["東京", "大阪", "福岡"]
})

# CSVファイルに保存
df.to_csv("output.csv")
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       to_csv の動作イメージ                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【DataFrame】                          【保存される CSV】             │
│                                                                         │
│   ┌──────────────────────────────┐       ┌──────────────────────────┐   │
│   │       名前   年齢   都市     │       │ ,名前,年齢,都市          │   │
│   │    0  田中    25    東京     │ ───→  │ 0,田中,25,東京           │   │
│   │    1  佐藤    30    大阪     │       │ 1,佐藤,30,大阪           │   │
│   │    2  鈴木    28    福岡     │       │ 2,鈴木,28,福岡           │   │
│   └──────────────────────────────┘       └──────────────────────────┘   │
│         ↑                                       ↑                       │
│         インデックス(0,1,2)                     インデックスも保存される│
│                                                                         │
│   ⚠️ デフォルトでは行番号（インデックス）も保存される                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 インデックスを保存しない

```python
# インデックスを保存しない（よく使う！）
df.to_csv("output.csv", index=False)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     index=False の効果                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df.to_csv("output.csv")              df.to_csv("output.csv",          │
│                                                  index=False)           │
│                                                                         │
│   ┌──────────────────────────┐         ┌──────────────────────────┐     │
│   │ ,名前,年齢,都市          │         │ 名前,年齢,都市           │     │
│   │ 0,田中,25,東京           │   ───→  │ 田中,25,東京             │     │
│   │ 1,佐藤,30,大阪           │         │ 佐藤,30,大阪             │     │
│   │ 2,鈴木,28,福岡           │         │ 鈴木,28,福岡             │     │
│   └──────────────────────────┘         └──────────────────────────┘     │
│         ↑                                    ↑                          │
│         余計な列がある                       スッキリ！                 │
│                                                                         │
│   💡 Excel で開く予定があるなら index=False がおすすめ！                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 その他のオプション

```python
# 文字コード指定
df.to_csv("output.csv", encoding="utf-8")
df.to_csv("output.csv", encoding="shift-jis")  # Excel(Windows)で開く場合

# ヘッダーを含めない
df.to_csv("output.csv", header=False, index=False)

# 区切り文字を変更（タブ区切り）
df.to_csv("output.tsv", sep="\t", index=False)
```

---

## 📘 4. Excelファイルへの保存（to_excel）

### 4.1 基本的な保存

```python
import pandas as pd

# サンプルデータ
df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木"],
    "年齢": [25, 30, 28],
    "都市": ["東京", "大阪", "福岡"]
})

# Excelファイルに保存
df.to_excel("output.xlsx", index=False)
```

### 4.2 シート名を指定して保存

```python
# シート名を指定
df.to_excel("output.xlsx", sheet_name="社員データ", index=False)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      to_excel の動作イメージ                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df.to_excel("output.xlsx", sheet_name="社員データ", index=False)      │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  📊 output.xlsx                                                 │   │
│   │  ┌──────────────┐                                               │   │
│   │  │  社員データ  │  ← 指定したシート名                           │   │
│   │  └──────────────┘                                               │   │
│   │  ┌────────┬────────┬────────┐                                   │   │
│   │  │  名前  │  年齢  │  都市  │                                   │   │
│   │  ├────────┼────────┼────────┤                                   │   │
│   │  │  田中  │   25   │  東京  │                                   │   │
│   │  │  佐藤  │   30   │  大阪  │                                   │   │
│   │  │  鈴木  │   28   │  福岡  │                                   │   │
│   │  └────────┴────────┴────────┘                                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 複数のDataFrameを別シートに保存

```python
import pandas as pd

# 2つのDataFrame
df_sales = pd.DataFrame({"商品": ["A", "B"], "売上": [100, 200]})
df_customer = pd.DataFrame({"名前": ["田中", "佐藤"], "年齢": [25, 30]})

# ExcelWriter を使って複数シートに保存
with pd.ExcelWriter("report.xlsx") as writer:
    df_sales.to_excel(writer, sheet_name="売上", index=False)
    df_customer.to_excel(writer, sheet_name="顧客", index=False)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    複数シートへの保存                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   with pd.ExcelWriter("report.xlsx") as writer:                         │
│       df_sales.to_excel(writer, sheet_name="売上", ...)                 │
│       df_customer.to_excel(writer, sheet_name="顧客", ...)              │
│                                                                         │
│         │                                                               │
│         ▼                                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  📊 report.xlsx                                                 │   │
│   │  ┌────────┬────────┐                                            │   │
│   │  │  売上  │  顧客  │  ← 2つのシートができる                     │   │
│   │  └────────┴────────┘                                            │   │
│   │                                                                 │   │
│   │  [売上シート]              [顧客シート]                         │   │
│   │  ┌────────┬────────┐       ┌────────┬────────┐                  │   │
│   │  │  商品  │  売上  │       │  名前  │  年齢  │                  │   │
│   │  ├────────┼────────┤       ├────────┼────────┤                  │   │
│   │  │   A    │  100   │       │  田中  │   25   │                  │   │
│   │  │   B    │  200   │       │  佐藤  │   30   │                  │   │
│   │  └────────┴────────┘       └────────┴────────┘                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   💡 月次レポートなど、関連データをまとめるのに便利！                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 5. データの確認メソッド

ファイルを読み込んだら、まず中身を確認することが重要です。

### 5.1 よく使う確認メソッド

```python
import pandas as pd

df = pd.read_csv("data.csv")

# 先頭5行を表示
df.head()

# 末尾5行を表示
df.tail()

# 行数・列数を確認
df.shape  # (行数, 列数)

# データ型と欠損値の情報
df.info()

# 基本統計量
df.describe()
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      データ確認の流れ                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   📁 CSVファイルを読み込んだ直後にやるべきこと                          │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df = pd.read_csv("data.csv")                                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│         │                                                               │
│         ▼                                                               │
│   ┌───────────────┐    ┌───────────────┐    ┌───────────────┐           │
│   │   df.head()   │    │   df.shape    │    │   df.info()   │           │
│   ├───────────────┤    ├───────────────┤    ├───────────────┤           │
│   │ 最初の5行を   │    │ 全体のサイズ  │    │ 各列のデータ  │           │
│   │ 目視確認      │    │ を把握        │    │ 型を確認      │           │
│   └───────────────┘    └───────────────┘    └───────────────┘           │
│                                                                         │
│   💡 この3つはセットで実行する習慣をつけよう！                          │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  print(df.head())           # 中身を見る                        │   │
│   │  print(df.shape)            # サイズ確認 (1000, 5) = 1000行5列  │   │
│   │  print(df.info())           # データ型と欠損値                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 info() の出力例

```python
df.info()
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      df.info() の出力イメージ                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   <class 'pandas.core.frame.DataFrame'>                                 │
│   RangeIndex: 100 entries, 0 to 99          ← 100行ある                 │
│   Data columns (total 4 columns):            ← 4列ある                  │
│    #   Column  Non-Null Count  Dtype                                    │
│   ---  ------  --------------  -----                                    │
│    0   名前    100 non-null    object       ← 文字列、欠損なし          │
│    1   年齢    98 non-null     float64      ← 数値、2つ欠損あり！       │
│    2   都市    100 non-null    object       ← 文字列、欠損なし          │
│    3   売上    100 non-null    int64        ← 整数、欠損なし            │
│   dtypes: float64(1), int64(1), object(2)                               │
│   memory usage: 3.2+ KB                                                 │
│                                                                         │
│   ⚠️ Non-Null Count が行数より少ない場合、欠損値がある！                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📝 まとめ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    このセクションで学んだこと                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【読み込み】                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  CSV読み込み    pd.read_csv("file.csv")                         │   │
│   │  Excel読み込み  pd.read_excel("file.xlsx")                      │   │
│   │  シート指定     pd.read_excel("file.xlsx", sheet_name="売上")   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   【保存】                                                              │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  CSV保存        df.to_csv("file.csv", index=False)              │   │
│   │  Excel保存      df.to_excel("file.xlsx", index=False)           │   │
│   │  シート名指定   df.to_excel("file.xlsx", sheet_name="結果")     │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   【確認メソッド】                                                      │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df.head()     先頭5行表示                                      │   │
│   │  df.tail()     末尾5行表示                                      │   │
│   │  df.shape      サイズ確認 (行数, 列数)                          │   │
│   │  df.info()     データ型と欠損値の情報                           │   │
│   │  df.describe() 基本統計量                                       │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   💡 ポイント: index=False をつけると余計な列が保存されない！           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
