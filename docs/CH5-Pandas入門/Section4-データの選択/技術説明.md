# Section4: データの選択

## 🎯 このセクションで学ぶこと

DataFrame から必要なデータを選択する方法を学びます。
Excel で「特定の列だけ表示」「特定の行だけ表示」する操作を
Python で実現できるようになります。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       データ選択のイメージ                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【元のDataFrame】                    【選択後】                       │
│                                                                         │
│   ┌─────┬─────┬─────┬─────┐           ┌─────┬─────┐                     │
│   │ 名前│ 年齢│ 部署│ 年収│           │ 名前│ 年収│  ← 列を選択         │
│   ├─────┼─────┼─────┼─────┤           ├─────┼─────┤                     │
│   │ 田中│  25 │ 営業│ 400 │  ───→     │ 田中│ 400 │                     │
│   │ 佐藤│  30 │ 開発│ 500 │           │ 鈴木│ 450 │  ← 行を選択         │
│   │ 鈴木│  28 │ 営業│ 450 │           └─────┴─────┘                     │
│   │ 高橋│  35 │ 人事│ 480 │                                             │
│   └─────┴─────┴─────┴─────┘                                             │
│                                                                         │
│   😊 必要なデータだけを取り出して分析できる！                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 1. カラム（列）の選択

### 1.1 1つのカラムを選択する

```python
import pandas as pd

# サンプルデータ
df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋"],
    "年齢": [25, 30, 28, 35],
    "部署": ["営業", "開発", "営業", "人事"],
    "年収": [400, 500, 450, 480]
})

# 1つのカラムを選択（Series として取得）
names = df["名前"]
print(names)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      1カラム選択のイメージ                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df["名前"]                                                            │
│      │                                                                  │
│      ▼  この列だけを取り出す                                            │
│   ┌─────┬─────┬─────┬─────┐        ┌─────┐                              │
│   │▶名前│ 年齢│ 部署│ 年収│        │ 名前│  ← Series（1次元）           │
│   ├─────┼─────┼─────┼─────┤        ├─────┤                              │
│   │ 田中│  25 │ 営業│ 400 │   →    │ 田中│  0                           │
│   │ 佐藤│  30 │ 開発│ 500 │        │ 佐藤│  1                           │
│   │ 鈴木│  28 │ 営業│ 450 │        │ 鈴木│  2                           │
│   │ 高橋│  35 │ 人事│ 480 │        │ 高橋│  3                           │
│   └─────┴─────┴─────┴─────┘        └─────┘                              │
│                                       ↑                                 │
│                                       インデックスも一緒についてくる    │
│                                                                         │
│   💡 df["カラム名"] → Series として返る                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 複数のカラムを選択する

```python
# 複数のカラムを選択（DataFrame として取得）
subset = df[["名前", "年収"]]
print(subset)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      複数カラム選択のイメージ                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df[["名前", "年収"]]   ← リストで複数指定                             │
│      │                                                                  │
│      ▼                                                                  │
│   ┌─────┬─────┬─────┬─────┐        ┌─────┬─────┐                        │
│   │▶名前│ 年齢│ 部署│▶年収│        │ 名前│ 年収│  ← DataFrame（2次元）  │
│   ├─────┼─────┼─────┼─────┤        ├─────┼─────┤                        │
│   │ 田中│  25 │ 営業│ 400 │   →    │ 田中│ 400 │                        │
│   │ 佐藤│  30 │ 開発│ 500 │        │ 佐藤│ 500 │                        │
│   │ 鈴木│  28 │ 営業│ 450 │        │ 鈴木│ 450 │                        │
│   │ 高橋│  35 │ 人事│ 480 │        │ 高橋│ 480 │                        │
│   └─────┴─────┴─────┴─────┘        └─────┴─────┘                        │
│                                                                         │
│   ⚠️ 注意: [[ ]] 二重括弧になる！                                       │
│   • df["名前"]        → Series                                          │
│   • df[["名前"]]      → DataFrame（1列だけでも DataFrame）              │
│   • df[["名前","年収"]] → DataFrame                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 2. loc[] によるラベルベースの選択

### 2.1 loc[] とは？

`loc[]` は **ラベル（名前）** を使ってデータを選択する方法です。
行ラベル（インデックス）とカラム名で指定します。

```python
import pandas as pd

# インデックスに名前を設定したDataFrame
df = pd.DataFrame({
    "年齢": [25, 30, 28, 35],
    "部署": ["営業", "開発", "営業", "人事"],
    "年収": [400, 500, 450, 480]
}, index=["田中", "佐藤", "鈴木", "高橋"])

print(df)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         loc[] の基本構造                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df.loc[行ラベル, カラム名]                                            │
│          │           │                                                  │
│          │           └─ 列を指定（省略可能）                            │
│          └─ 行を指定                                                    │
│                                                                         │
│   【DataFrame の構造】                                                  │
│                                                                         │
│            年齢    部署    年収   ← カラム名（列ラベル）                │
│          ┌─────┬──────┬─────┐                                           │
│     田中 │  25 │ 営業 │ 400 │                                           │
│     佐藤 │  30 │ 開発 │ 500 │  ← 行ラベル（インデックス）               │
│     鈴木 │  28 │ 営業 │ 450 │                                           │
│     高橋 │  35 │ 人事 │ 480 │                                           │
│          └─────┴──────┴─────┘                                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 loc[] の使用例

```python
# 1行を選択
print(df.loc["田中"])

# 1行1列を選択（特定のセル）
print(df.loc["田中", "年収"])  # → 400

# 複数行を選択
print(df.loc[["田中", "鈴木"]])

# 行と列を同時に選択
print(df.loc[["田中", "鈴木"], ["年齢", "年収"]])

# スライスで範囲選択（ラベルの範囲）
print(df.loc["田中":"鈴木"])  # 田中から鈴木まで（鈴木を含む！）
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       loc[] 使用例のイメージ                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ① df.loc["田中"]  → 1行を Series で取得                              │
│                                                                         │
│            年齢  部署   年収                    年齢: 25                │
│          ┌─────┬──────┬─────┐                   部署: 営業              │
│    ▶田中 │  25 │ 営業 │ 400 │   →               年収: 400               │
│     佐藤 │  30 │ 開発 │ 500 │                                           │
│          └─────┴──────┴─────┘                                           │
│                                                                         │
│   ② df.loc["田中", "年収"]  → 1つの値を取得                            │
│                                                                         │
│            年齢  部署  ▶年収                                            │
│          ┌─────┬──────┬─────┐                                           │
│    ▶田中 │  25 │ 営業 │ 400 │   →   400                                 │
│     佐藤 │  30 │ 開発 │ 500 │                                           │
│          └─────┴──────┴─────┘                                           │
│                                                                         │
│   ③ df.loc[["田中", "鈴木"], ["年齢", "年収"]]  → 部分 DataFrame       │
│                                                                         │
│           ▶年齢  部署  ▶年収          年齢  年収                        │
│          ┌─────┬──────┬─────┐       ┌─────┬─────┐                       │
│    ▶田中 │  25 │ 営業 │ 400 │   →   │  25 │ 400 │ 田中                  │
│     佐藤 │  30 │ 開発 │ 500 │       │  28 │ 450 │ 鈴木                  │
│    ▶鈴木 │  28 │ 営業 │ 450 │       └─────┴─────┘                       │
│          └─────┴──────┴─────┘                                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.3 loc[] でのスライス（重要！）

```python
# loc でのスライスは「終点を含む」
print(df.loc["田中":"鈴木"])  # 田中、佐藤、鈴木 の3行
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       loc[] スライスの特徴                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df.loc["田中":"鈴木"]                                                 │
│                                                                         │
│            年齢    部署    年収                                         │
│          ┌─────┬──────┬─────┐        ┌─────┬──────┬─────┐               │
│    ▶田中 │  25 │ 営業 │ 400 │        │  25 │ 営業 │ 400 │ 田中          │
│    ▶佐藤 │  30 │ 開発 │ 500 │   →    │  30 │ 開発 │ 500 │ 佐藤          │
│    ▶鈴木 │  28 │ 営業 │ 450 │        │  28 │ 営業 │ 450 │ 鈴木          │
│     高橋 │  35 │ 人事 │ 480 │        └─────┴──────┴─────┘               │
│          └─────┴──────┴─────┘                                           │
│                                                                         │
│   ⚠️ 通常の Python スライスとの違い:                                    │
│   • Python リスト [0:3] → 0, 1, 2（3は含まない）                        │
│   • loc["田中":"鈴木"] → 田中, 佐藤, 鈴木（鈴木を含む！）               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 3. iloc[] による位置ベースの選択

### 3.1 iloc[] とは？

`iloc[]` は **位置（番号）** を使ってデータを選択する方法です。
0から始まる番号で指定します。

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋"],
    "年齢": [25, 30, 28, 35],
    "部署": ["営業", "開発", "営業", "人事"],
    "年収": [400, 500, 450, 480]
})
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        iloc[] の基本構造                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   df.iloc[行番号, 列番号]                                               │
│           │        │                                                    │
│           │        └─ 列を番号で指定（0から開始）                       │
│           └─ 行を番号で指定（0から開始）                                │
│                                                                         │
│   【DataFrame の位置番号】                                              │
│                                                                         │
│       列番号:  0    1     2      3                                      │
│              名前  年齢  部署   年収                                    │
│            ┌─────┬─────┬──────┬─────┐                                   │
│   行番号0  │ 田中│  25 │ 営業 │ 400 │                                   │
│   行番号1  │ 佐藤│  30 │ 開発 │ 500 │                                   │
│   行番号2  │ 鈴木│  28 │ 営業 │ 450 │                                   │
│   行番号3  │ 高橋│  35 │ 人事 │ 480 │                                   │
│            └─────┴─────┴──────┴─────┘                                   │
│                                                                         │
│   💡 iloc = integer location（整数位置）                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 iloc[] の使用例

```python
# 1行を選択（0番目 = 最初の行）
print(df.iloc[0])

# 1行1列を選択（0行目の3列目）
print(df.iloc[0, 3])  # → 400

# 複数行を選択
print(df.iloc[[0, 2]])  # 0行目と2行目

# スライスで範囲選択
print(df.iloc[0:2])  # 0行目と1行目（2は含まない！）

# 行と列を同時に選択
print(df.iloc[0:2, 1:3])  # 0-1行目の、1-2列目
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      iloc[] 使用例のイメージ                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ① df.iloc[0]  → 0行目（最初の行）を取得                              │
│                                                                         │
│       列:   0     1     2      3                                        │
│            名前  年齢  部署   年収               名前: 田中             │
│          ┌─────┬─────┬──────┬─────┐              年齢: 25               │
│   行 ▶0  │ 田中│  25 │ 営業 │ 400 │   →          部署: 営業             │
│       1  │ 佐藤│  30 │ 開発 │ 500 │              年収: 400              │
│          └─────┴─────┴──────┴─────┘                                     │
│                                                                         │
│   ② df.iloc[0:2, 1:3]  → 0-1行目の、1-2列目を取得                      │
│                                                                         │
│       列:   0    ▶1    ▶2      3                                        │
│            名前  年齢  部署   年収          年齢  部署                  │
│          ┌─────┬─────┬──────┬─────┐       ┌─────┬──────┐                │
│   行 ▶0  │ 田中│  25 │ 営業 │ 400 │   →   │  25 │ 営業 │                │
│      ▶1  │ 佐藤│  30 │ 開発 │ 500 │       │  30 │ 開発 │                │
│       2  │ 鈴木│  28 │ 営業 │ 450 │       └─────┴──────┘                │
│          └─────┴─────┴──────┴─────┘                                     │
│                                                                         │
│   ⚠️ iloc のスライスは終点を「含まない」（通常の Python と同じ）        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 4. loc[] と iloc[] の比較

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      loc[] と iloc[] の違い                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   ┌───────────┬────────────────────┬────────────────────┐               │
│   │           │       loc[]        │       iloc[]       │               │
│   ├───────────┼────────────────────┼────────────────────┤               │
│   │ 指定方法  │ ラベル（名前）     │ 位置（番号）       │               │
│   ├───────────┼────────────────────┼────────────────────┤               │
│   │ 行の指定  │ インデックス名     │ 0, 1, 2, ...       │               │
│   ├───────────┼────────────────────┼────────────────────┤               │
│   │ 列の指定  │ カラム名           │ 0, 1, 2, ...       │               │
│   ├───────────┼────────────────────┼────────────────────┤               │
│   │ スライス  │ 終点を含む         │ 終点を含まない     │               │
│   ├───────────┼────────────────────┼────────────────────┤               │
│   │ 例        │ df.loc["田中"]     │ df.iloc[0]         │               │
│   │           │ df.loc[:, "年収"]  │ df.iloc[:, 3]      │               │
│   └───────────┴────────────────────┴────────────────────┘               │
│                                                                         │
│   【スライスの違いに注意！】                                            │
│                                                                         │
│   df.loc["田中":"鈴木"]   → 田中, 佐藤, 鈴木（鈴木を含む）              │
│   df.iloc[0:3]            → 0, 1, 2 行目（3は含まない）                 │
│                                                                         │
│   💡 使い分け:                                                          │
│   • 名前で指定したい → loc[]                                            │
│   • 番号で指定したい → iloc[]                                           │
│   • 「最初の3行」など位置で → iloc[]                                    │
│   • 「田中さんの年収」など名前で → loc[]                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 5. at[] と iat[] による高速アクセス

1つのセル（値）にアクセスする場合、`at[]` と `iat[]` を使うと高速です。

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木"],
    "年収": [400, 500, 450]
}, index=["A", "B", "C"])

# at[] - ラベルで1つのセルにアクセス
print(df.at["A", "年収"])  # → 400

# iat[] - 番号で1つのセルにアクセス
print(df.iat[0, 1])  # → 400

# 値を変更することもできる
df.at["A", "年収"] = 420
print(df)
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      at[] / iat[] のイメージ                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【at[] - ラベルで1セルにアクセス】                                    │
│                                                                         │
│   df.at["A", "年収"]                                                    │
│          │      │                                                       │
│          │      └─ カラム名                                             │
│          └─ 行ラベル                                                    │
│                                                                         │
│           名前  ▶年収                                                   │
│         ┌─────┬──────┐                                                  │
│   行 ▶A │ 田中│▶ 400 │  → 400                                           │
│       B │ 佐藤│  500 │                                                  │
│       C │ 鈴木│  450 │                                                  │
│         └─────┴──────┘                                                  │
│                                                                         │
│   【iat[] - 番号で1セルにアクセス】                                     │
│                                                                         │
│   df.iat[0, 1]                                                          │
│          │  │                                                           │
│          │  └─ 列番号（0から開始）                                      │
│          └─ 行番号（0から開始）                                         │
│                                                                         │
│       列:    0     ▶1                                                   │
│            名前    年収                                                 │
│          ┌─────┬──────┐                                                 │
│   行 ▶0  │ 田中│▶ 400 │  → 400                                          │
│       1  │ 佐藤│  500 │                                                 │
│          └─────┴──────┘                                                 │
│                                                                         │
│   💡 loc/iloc は範囲選択もできるが、at/iat は1セル専用で高速            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📘 6. 実践的な選択パターン

### 6.1 よく使うパターンまとめ

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋"],
    "年齢": [25, 30, 28, 35],
    "部署": ["営業", "開発", "営業", "人事"],
    "年収": [400, 500, 450, 480]
})

# === カラム選択 ===
df["名前"]              # 1列を Series で
df[["名前", "年収"]]    # 複数列を DataFrame で

# === 行選択（iloc で位置指定）===
df.iloc[0]              # 最初の行
df.iloc[-1]             # 最後の行
df.iloc[:3]             # 先頭3行
df.iloc[-3:]            # 末尾3行

# === 特定のセル ===
df.iloc[0, 1]           # 0行目の1列目の値
df.at[0, "年齢"]        # 0行目の「年齢」列の値（インデックスが数値の場合）

# === 行と列を同時に ===
df.iloc[0:2, 1:3]       # 最初の2行の、2-3列目
df.loc[:, ["名前", "年収"]]  # 全行の、名前と年収列
```

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    選択パターン早見表                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   やりたいこと              コード                                      │
│   ─────────────────────────────────────────────────────────────────     │
│   1列を取得                 df["カラム名"]                              │
│   複数列を取得              df[["列1", "列2"]]                          │
│   最初の行                  df.iloc[0]                                  │
│   最後の行                  df.iloc[-1]                                 │
│   先頭N行                   df.iloc[:N]  または df.head(N)              │
│   末尾N行                   df.iloc[-N:] または df.tail(N)              │
│   特定の1セル（位置）       df.iloc[行番号, 列番号]                     │
│   特定の1セル（ラベル）     df.loc[行ラベル, カラム名]                  │
│   1セル高速アクセス         df.at[行ラベル, カラム名]                   │
│   範囲選択（位置）          df.iloc[行start:end, 列start:end]           │
│   範囲選択（ラベル）        df.loc[行start:end, 列リスト]               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 📝 まとめ

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    このセクションで学んだこと                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   【カラム選択】                                                        │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df["列名"]           1列を Series で取得                       │   │
│   │  df[["列1", "列2"]]   複数列を DataFrame で取得                 │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   【loc[] - ラベルベース】                                              │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df.loc[行ラベル]              1行を取得                        │   │
│   │  df.loc[行ラベル, カラム名]    特定のセルを取得                 │   │
│   │  df.loc[行start:end]           範囲選択（終点を含む）           │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   【iloc[] - 位置ベース】                                               │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df.iloc[行番号]               1行を取得                        │   │
│   │  df.iloc[行番号, 列番号]       特定のセルを取得                 │   │
│   │  df.iloc[行start:end]          範囲選択（終点を含まない）       │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   【at[] / iat[] - 1セル専用（高速）】                                  │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │  df.at[行ラベル, カラム名]     ラベルで1セル                    │   │
│   │  df.iat[行番号, 列番号]        番号で1セル                      │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│   💡 ポイント: loc は終点を含む、iloc は終点を含まない！                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```
