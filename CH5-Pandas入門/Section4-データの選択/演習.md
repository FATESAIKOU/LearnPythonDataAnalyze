# Section4: データの選択 - 演習問題

## 🎯 この演習の目的

DataFrame から必要なデータを選択する操作を練習します。
loc[], iloc[], at[], iat[] の違いを理解しましょう。

---

## 📝 演習1: カラム（列）の選択

### 問題

以下の DataFrame から、指定されたカラムを選択してください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品名": ["りんご", "みかん", "バナナ", "ぶどう", "いちご"],
    "カテゴリ": ["果物", "果物", "果物", "果物", "果物"],
    "価格": [150, 100, 200, 350, 500],
    "在庫": [30, 50, 20, 15, 10],
    "産地": ["青森", "愛媛", "フィリピン", "山梨", "栃木"]
})
```

1. 「商品名」列だけを取得（Series として）
2. 「商品名」と「価格」の2列を取得（DataFrame として）
3. 「商品名」「価格」「在庫」の3列を取得

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品名": ["りんご", "みかん", "バナナ", "ぶどう", "いちご"],
    "カテゴリ": ["果物", "果物", "果物", "果物", "果物"],
    "価格": [150, 100, 200, 350, 500],
    "在庫": [30, 50, 20, 15, 10],
    "産地": ["青森", "愛媛", "フィリピン", "山梨", "栃木"]
})

print("=== 元の DataFrame ===")
print(df)
print()

# ===== 1. 「商品名」列だけを取得（Series として）=====

names = df["商品名"]

print("=== 1. 商品名列（Series）===")
print(names)
print(f"型: {type(names)}")
print()

# ===== 2. 「商品名」と「価格」の2列を取得（DataFrame として）=====

name_price = df[["商品名", "価格"]]

print("=== 2. 商品名と価格（DataFrame）===")
print(name_price)
print(f"型: {type(name_price)}")
print()

# ===== 3. 「商品名」「価格」「在庫」の3列を取得 =====

subset = df[["商品名", "価格", "在庫"]]

print("=== 3. 商品名・価格・在庫 ===")
print(subset)
```

**実行結果:**
```
=== 元の DataFrame ===
   商品名 カテゴリ   価格  在庫        産地
0  りんご     果物  150   30        青森
1  みかん     果物  100   50        愛媛
2  バナナ     果物  200   20  フィリピン
3  ぶどう     果物  350   15        山梨
4  いちご     果物  500   10        栃木

=== 1. 商品名列（Series）===
0    りんご
1    みかん
2    バナナ
3    ぶどう
4    いちご
Name: 商品名, dtype: object
型: <class 'pandas.core.series.Series'>

=== 2. 商品名と価格（DataFrame）===
   商品名   価格
0  りんご  150
1  みかん  100
2  バナナ  200
3  ぶどう  350
4  いちご  500
型: <class 'pandas.core.frame.DataFrame'>

=== 3. 商品名・価格・在庫 ===
   商品名   価格  在庫
0  りんご  150   30
1  みかん  100   50
2  バナナ  200   20
3  ぶどう  350   15
4  いちご  500   10
```

</details>

---

## 📝 演習2: iloc[] で位置ベースの選択

### 問題

以下の DataFrame から、iloc[] を使ってデータを選択してください。

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋", "伊藤"],
    "年齢": [25, 30, 28, 35, 42],
    "部署": ["営業", "開発", "営業", "人事", "経理"],
    "年収": [400, 500, 450, 480, 520]
})
```

1. 最初の行（0行目）を取得
2. 最後の行を取得
3. 先頭3行を取得
4. 2行目の「年収」（3列目）の値を取得
5. 1〜3行目（インデックス1,2,3）の「名前」と「年収」を取得

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "名前": ["田中", "佐藤", "鈴木", "高橋", "伊藤"],
    "年齢": [25, 30, 28, 35, 42],
    "部署": ["営業", "開発", "営業", "人事", "経理"],
    "年収": [400, 500, 450, 480, 520]
})

print("=== 元の DataFrame ===")
print(df)
print()

# ===== 1. 最初の行（0行目）を取得 =====

first_row = df.iloc[0]

print("=== 1. 最初の行 ===")
print(first_row)
print()

# ===== 2. 最後の行を取得 =====

last_row = df.iloc[-1]

print("=== 2. 最後の行 ===")
print(last_row)
print()

# ===== 3. 先頭3行を取得 =====

first_three = df.iloc[:3]

print("=== 3. 先頭3行 ===")
print(first_three)
print()

# ===== 4. 2行目の「年収」（3列目）の値を取得 =====

salary_row2 = df.iloc[2, 3]

print("=== 4. 2行目の年収（3列目）===")
print(f"値: {salary_row2}")
print(f"（鈴木さんの年収 = {salary_row2}万円）")
print()

# ===== 5. 1〜3行目の「名前」と「年収」を取得 =====

# 名前は0列目、年収は3列目
subset = df.iloc[1:4, [0, 3]]

print("=== 5. 1〜3行目の名前と年収 ===")
print(subset)
```

**実行結果:**
```
=== 元の DataFrame ===
   名前  年齢  部署  年収
0  田中   25  営業  400
1  佐藤   30  開発  500
2  鈴木   28  営業  450
3  高橋   35  人事  480
4  伊藤   42  経理  520

=== 1. 最初の行 ===
名前    田中
年齢      25
部署    営業
年収     400
Name: 0, dtype: object

=== 2. 最後の行 ===
名前    伊藤
年齢      42
部署    経理
年収     520
Name: 4, dtype: object

=== 3. 先頭3行 ===
   名前  年齢  部署  年収
0  田中   25  営業  400
1  佐藤   30  開発  500
2  鈴木   28  営業  450

=== 4. 2行目の年収（3列目）===
値: 450
（鈴木さんの年収 = 450万円）

=== 5. 1〜3行目の名前と年収 ===
   名前  年収
1  佐藤  500
2  鈴木  450
3  高橋  480
```

</details>

---

## 📝 演習3: loc[] でラベルベースの選択

### 問題

以下の DataFrame（インデックスに名前を設定）から、loc[] を使ってデータを選択してください。

```python
import pandas as pd

df = pd.DataFrame({
    "年齢": [25, 30, 28, 35, 42],
    "部署": ["営業", "開発", "営業", "人事", "経理"],
    "年収": [400, 500, 450, 480, 520]
}, index=["田中", "佐藤", "鈴木", "高橋", "伊藤"])
```

1. 「田中」さんの行を取得
2. 「鈴木」さんの「年収」を取得
3. 「佐藤」から「高橋」までの行を取得
4. 「田中」と「伊藤」の「年齢」と「年収」を取得

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "年齢": [25, 30, 28, 35, 42],
    "部署": ["営業", "開発", "営業", "人事", "経理"],
    "年収": [400, 500, 450, 480, 520]
}, index=["田中", "佐藤", "鈴木", "高橋", "伊藤"])

print("=== 元の DataFrame ===")
print(df)
print()

# ===== 1. 「田中」さんの行を取得 =====

tanaka = df.loc["田中"]

print("=== 1. 田中さんの行 ===")
print(tanaka)
print()

# ===== 2. 「鈴木」さんの「年収」を取得 =====

suzuki_salary = df.loc["鈴木", "年収"]

print("=== 2. 鈴木さんの年収 ===")
print(f"年収: {suzuki_salary}万円")
print()

# ===== 3. 「佐藤」から「高橋」までの行を取得 =====

sato_to_takahashi = df.loc["佐藤":"高橋"]

print("=== 3. 佐藤から高橋まで ===")
print(sato_to_takahashi)
print("（注: loc のスライスは終点を含む！）")
print()

# ===== 4. 「田中」と「伊藤」の「年齢」と「年収」を取得 =====

subset = df.loc[["田中", "伊藤"], ["年齢", "年収"]]

print("=== 4. 田中と伊藤の年齢・年収 ===")
print(subset)
```

**実行結果:**
```
=== 元の DataFrame ===
      年齢  部署  年収
田中    25  営業  400
佐藤    30  開発  500
鈴木    28  営業  450
高橋    35  人事  480
伊藤    42  経理  520

=== 1. 田中さんの行 ===
年齢      25
部署    営業
年収     400
Name: 田中, dtype: object

=== 2. 鈴木さんの年収 ===
年収: 450万円

=== 3. 佐藤から高橋まで ===
      年齢  部署  年収
佐藤    30  開発  500
鈴木    28  営業  450
高橋    35  人事  480
（注: loc のスライスは終点を含む！）

=== 4. 田中と伊藤の年齢・年収 ===
      年齢  年収
田中    25  400
伊藤    42  520
```

</details>

---

## 📝 演習4: at[] と iat[] で1セルにアクセス

### 問題

以下の DataFrame で、at[] と iat[] を使って特定のセルにアクセスし、値を変更してください。

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C"],
    "価格": [100, 200, 300],
    "在庫": [10, 20, 30]
})
```

1. iat[] で0行目1列目（商品Aの価格）の値を取得
2. at[] で1行目の「在庫」の値を取得
3. iat[] で2行目1列目の値を 350 に変更
4. at[] で0行目の「在庫」を 15 に変更
5. 変更後の DataFrame を表示

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "商品": ["A", "B", "C"],
    "価格": [100, 200, 300],
    "在庫": [10, 20, 30]
})

print("=== 元の DataFrame ===")
print(df)
print()

# ===== 1. iat[] で0行目1列目（商品Aの価格）の値を取得 =====

price_a = df.iat[0, 1]

print("=== 1. iat[0, 1] の値 ===")
print(f"商品Aの価格: {price_a}")
print()

# ===== 2. at[] で1行目の「在庫」の値を取得 =====

stock_b = df.at[1, "在庫"]

print("=== 2. at[1, '在庫'] の値 ===")
print(f"商品Bの在庫: {stock_b}")
print()

# ===== 3. iat[] で2行目1列目の値を 350 に変更 =====

print("=== 3. iat[2, 1] を 350 に変更 ===")
print(f"変更前: {df.iat[2, 1]}")
df.iat[2, 1] = 350
print(f"変更後: {df.iat[2, 1]}")
print()

# ===== 4. at[] で0行目の「在庫」を 15 に変更 =====

print("=== 4. at[0, '在庫'] を 15 に変更 ===")
print(f"変更前: {df.at[0, '在庫']}")
df.at[0, "在庫"] = 15
print(f"変更後: {df.at[0, '在庫']}")
print()

# ===== 5. 変更後の DataFrame を表示 =====

print("=== 5. 変更後の DataFrame ===")
print(df)
```

**実行結果:**
```
=== 元の DataFrame ===
  商品   価格  在庫
0    A  100   10
1    B  200   20
2    C  300   30

=== 1. iat[0, 1] の値 ===
商品Aの価格: 100

=== 2. at[1, '在庫'] の値 ===
商品Bの在庫: 20

=== 3. iat[2, 1] を 350 に変更 ===
変更前: 300
変更後: 350

=== 4. at[0, '在庫'] を 15 に変更 ===
変更前: 10
変更後: 15

=== 5. 変更後の DataFrame ===
  商品   価格  在庫
0    A  100   15
1    B  200   20
2    C  350   30
```

</details>

---

## 📝 演習5: loc[] と iloc[] の違いを確認

### 問題

以下の DataFrame で、loc[] と iloc[] のスライスの違いを確認してください。

```python
import pandas as pd

df = pd.DataFrame({
    "値": [10, 20, 30, 40, 50]
}, index=["A", "B", "C", "D", "E"])
```

1. iloc[1:3] で選択（何が返るか予想してから実行）
2. loc["B":"D"] で選択（何が返るか予想してから実行）
3. 両者の違いを確認

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

df = pd.DataFrame({
    "値": [10, 20, 30, 40, 50]
}, index=["A", "B", "C", "D", "E"])

print("=== 元の DataFrame ===")
print(df)
print()

# ===== 1. iloc[1:3] で選択 =====

result_iloc = df.iloc[1:3]

print("=== 1. iloc[1:3] の結果 ===")
print(result_iloc)
print("→ 1番目と2番目（B, C）が返る")
print("→ iloc のスライスは終点を「含まない」（通常のPythonと同じ）")
print()

# ===== 2. loc["B":"D"] で選択 =====

result_loc = df.loc["B":"D"]

print("=== 2. loc['B':'D'] の結果 ===")
print(result_loc)
print("→ B, C, D の3行が返る")
print("→ loc のスライスは終点を「含む」！")
print()

# ===== 3. 両者の違いを確認 =====

print("=== 3. 違いのまとめ ===")
print()
print("┌─────────────────────────────────────────────┐")
print("│  iloc[1:3]    → 位置 1, 2（3は含まない）    │")
print("│  loc['B':'D'] → ラベル B, C, D（Dを含む）   │")
print("└─────────────────────────────────────────────┘")
print()
print("iloc の結果:")
print(result_iloc.index.tolist())
print()
print("loc の結果:")
print(result_loc.index.tolist())
```

**実行結果:**
```
=== 元の DataFrame ===
    値
A  10
B  20
C  30
D  40
E  50

=== 1. iloc[1:3] の結果 ===
    値
B  20
C  30
→ 1番目と2番目（B, C）が返る
→ iloc のスライスは終点を「含まない」（通常のPythonと同じ）

=== 2. loc['B':'D'] の結果 ===
    値
B  20
C  30
D  40
→ B, C, D の3行が返る
→ loc のスライスは終点を「含む」！

=== 3. 違いのまとめ ===

┌─────────────────────────────────────────────┐
│  iloc[1:3]    → 位置 1, 2（3は含まない）    │
│  loc['B':'D'] → ラベル B, C, D（Dを含む）   │
└─────────────────────────────────────────────┘

iloc の結果:
['B', 'C']

loc の結果:
['B', 'C', 'D']
```

</details>

---

## 🎯 チェックリスト

以下ができるようになったか確認しましょう：

- [ ] `df["カラム名"]` で1列を Series として取得できる
- [ ] `df[["列1", "列2"]]` で複数列を DataFrame として取得できる
- [ ] `iloc[]` で位置（番号）ベースの選択ができる
- [ ] `loc[]` でラベル（名前）ベースの選択ができる
- [ ] `iloc` と `loc` のスライスの違いを理解している
- [ ] `at[]` と `iat[]` で1セルに高速アクセスできる
- [ ] セルの値を取得・変更できる
