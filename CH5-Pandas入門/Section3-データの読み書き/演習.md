# Section3: データの読み書き - 演習問題

## 🎯 この演習の目的

CSV/Excel ファイルの読み書きを実際に体験し、
データ分析の最初のステップを習得します。

---

## 📝 演習1: CSVファイルの作成と読み込み

### 問題

以下の手順で CSV ファイルを作成し、読み込んでください。

1. DataFrame を作成してCSVファイルに保存する
2. 保存したCSVファイルを読み込む
3. 読み込んだデータを確認する

**作成するデータ:**
| 商品名 | 価格 | 在庫 |
|--------|------|------|
| りんご | 150 | 30 |
| みかん | 100 | 50 |
| バナナ | 200 | 20 |
| ぶどう | 350 | 15 |

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

# ===== Step 1: DataFrame を作成して CSV に保存 =====

# データを作成
df = pd.DataFrame({
    "商品名": ["りんご", "みかん", "バナナ", "ぶどう"],
    "価格": [150, 100, 200, 350],
    "在庫": [30, 50, 20, 15]
})

# 作成したデータを確認
print("=== 作成した DataFrame ===")
print(df)
print()

# CSVファイルに保存（インデックスなし）
df.to_csv("fruits.csv", index=False)
print("fruits.csv に保存しました！")
print()

# ===== Step 2: CSV ファイルを読み込む =====

# 読み込み
df_loaded = pd.read_csv("fruits.csv")

# ===== Step 3: 読み込んだデータを確認 =====

print("=== 読み込んだ DataFrame ===")
print(df_loaded)
print()

print("=== データの形状 ===")
print(f"行数: {df_loaded.shape[0]}, 列数: {df_loaded.shape[1]}")
print()

print("=== データの情報 ===")
print(df_loaded.info())
```

**実行結果:**
```
=== 作成した DataFrame ===
   商品名   価格  在庫
0  りんご  150   30
1  みかん  100   50
2  バナナ  200   20
3  ぶどう  350   15

fruits.csv に保存しました！

=== 読み込んだ DataFrame ===
   商品名   価格  在庫
0  りんご  150   30
1  みかん  100   50
2  バナナ  200   20
3  ぶどう  350   15

=== データの形状 ===
行数: 4, 列数: 3

=== データの情報 ===
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 4 entries, 0 to 3
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   商品名  4 non-null      object
 1   価格    4 non-null      int64 
 2   在庫    4 non-null      int64 
dtypes: int64(2), object(1)
memory usage: 224.0+ bytes
None
```

</details>

---

## 📝 演習2: Excel ファイルへの保存

### 問題

以下の2つの DataFrame を、1つの Excel ファイルの異なるシートに保存してください。

**売上データ（シート名: 売上）:**
| 月 | 売上 |
|----|------|
| 1月 | 100000 |
| 2月 | 120000 |
| 3月 | 150000 |

**経費データ（シート名: 経費）:**
| 月 | 経費 |
|----|------|
| 1月 | 50000 |
| 2月 | 55000 |
| 3月 | 60000 |

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

# ===== 2つの DataFrame を作成 =====

# 売上データ
df_sales = pd.DataFrame({
    "月": ["1月", "2月", "3月"],
    "売上": [100000, 120000, 150000]
})

# 経費データ
df_expense = pd.DataFrame({
    "月": ["1月", "2月", "3月"],
    "経費": [50000, 55000, 60000]
})

print("=== 売上データ ===")
print(df_sales)
print()

print("=== 経費データ ===")
print(df_expense)
print()

# ===== 1つの Excel ファイルに複数シートで保存 =====

with pd.ExcelWriter("monthly_report.xlsx") as writer:
    df_sales.to_excel(writer, sheet_name="売上", index=False)
    df_expense.to_excel(writer, sheet_name="経費", index=False)

print("monthly_report.xlsx に保存しました！")
print("（売上シートと経費シートが作成されています）")
```

**実行結果:**
```
=== 売上データ ===
    月     売上
0  1月  100000
1  2月  120000
2  3月  150000

=== 経費データ ===
    月    経費
0  1月  50000
1  2月  55000
2  3月  60000

monthly_report.xlsx に保存しました！
（売上シートと経費シートが作成されています）
```

</details>

---

## 📝 演習3: Excel ファイルの読み込み

### 問題

演習2で作成した `monthly_report.xlsx` から、両方のシートを読み込み、
各月の「利益（売上 - 経費）」を計算してください。

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

# ===== 全シートを読み込む =====

all_sheets = pd.read_excel("monthly_report.xlsx", sheet_name=None)

print("=== 読み込んだシート一覧 ===")
print(list(all_sheets.keys()))
print()

# ===== 各シートを取り出す =====

df_sales = all_sheets["売上"]
df_expense = all_sheets["経費"]

print("=== 売上シート ===")
print(df_sales)
print()

print("=== 経費シート ===")
print(df_expense)
print()

# ===== 利益を計算 =====

# 2つのDataFrameを結合（月をキーに）
df_profit = df_sales.copy()
df_profit["経費"] = df_expense["経費"]
df_profit["利益"] = df_profit["売上"] - df_profit["経費"]

print("=== 利益計算結果 ===")
print(df_profit)
print()

print("=== 合計 ===")
print(f"売上合計: {df_profit['売上'].sum():,}円")
print(f"経費合計: {df_profit['経費'].sum():,}円")
print(f"利益合計: {df_profit['利益'].sum():,}円")
```

**実行結果:**
```
=== 読み込んだシート一覧 ===
['売上', '経費']

=== 売上シート ===
    月     売上
0  1月  100000
1  2月  120000
2  3月  150000

=== 経費シート ===
    月    経費
0  1月  50000
1  2月  55000
2  3月  60000

=== 利益計算結果 ===
    月     売上    経費    利益
0  1月  100000  50000  50000
1  2月  120000  55000  65000
2  3月  150000  60000  90000

=== 合計 ===
売上合計: 370,000円
経費合計: 165,000円
利益合計: 205,000円
```

</details>

---

## 📝 演習4: データの確認メソッドを使う

### 問題

以下のコードでサンプルデータを作成し、各種確認メソッドを実行してください。

```python
import pandas as pd
import numpy as np

# サンプルデータ（少し大きめ）
np.random.seed(42)
df = pd.DataFrame({
    "社員ID": range(1, 51),
    "名前": [f"社員{i}" for i in range(1, 51)],
    "部署": np.random.choice(["営業", "開発", "人事", "経理"], 50),
    "年齢": np.random.randint(22, 60, 50),
    "年収": np.random.randint(300, 800, 50) * 10000
})
```

以下を確認してください：
1. 先頭3行
2. 末尾3行
3. データの形状（行数と列数）
4. データの情報（info）
5. 基本統計量（describe）

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd
import numpy as np

# ===== サンプルデータを作成 =====

np.random.seed(42)
df = pd.DataFrame({
    "社員ID": range(1, 51),
    "名前": [f"社員{i}" for i in range(1, 51)],
    "部署": np.random.choice(["営業", "開発", "人事", "経理"], 50),
    "年齢": np.random.randint(22, 60, 50),
    "年収": np.random.randint(300, 800, 50) * 10000
})

# ===== 1. 先頭3行 =====

print("=== 先頭3行 (head) ===")
print(df.head(3))
print()

# ===== 2. 末尾3行 =====

print("=== 末尾3行 (tail) ===")
print(df.tail(3))
print()

# ===== 3. データの形状 =====

print("=== データの形状 (shape) ===")
print(f"形状: {df.shape}")
print(f"→ {df.shape[0]}行 × {df.shape[1]}列")
print()

# ===== 4. データの情報 =====

print("=== データの情報 (info) ===")
df.info()
print()

# ===== 5. 基本統計量 =====

print("=== 基本統計量 (describe) ===")
print(df.describe())
print()

# 文字列列も含めた統計
print("=== 全列の統計 (include='all') ===")
print(df.describe(include='all'))
```

**実行結果:**
```
=== 先頭3行 (head) ===
   社員ID   名前  部署  年齢      年収
0       1  社員1  開発    60  5740000
1       2  社員2  人事    43  5380000
2       3  社員3  営業    46  7640000

=== 末尾3行 (tail) ===
    社員ID    名前  部署  年齢      年収
47      48  社員48  営業    32  7540000
48      49  社員49  経理    35  5990000
49      50  社員50  開発    48  4970000

=== データの形状 (shape) ===
形状: (50, 5)
→ 50行 × 5列

=== データの情報 (info) ===
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 50 entries, 0 to 49
Data columns (total 5 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   社員ID  50 non-null     int64 
 1   名前    50 non-null     object
 2   部署    50 non-null     object
 3   年齢    50 non-null     int64 
 4   年収    50 non-null     int64 
dtypes: int64(3), object(2)
memory usage: 2.1+ KB

=== 基本統計量 (describe) ===
          社員ID        年齢           年収
count  50.000000  50.000000  5.000000e+01
mean   25.500000  39.860000  5.464800e+06
std    14.577380  10.839937  1.412945e+06
min     1.000000  22.000000  3.070000e+06
25%    13.250000  31.000000  4.297500e+06
50%    25.500000  39.500000  5.475000e+06
75%    37.750000  49.000000  6.580000e+06
max    50.000000  59.000000  7.830000e+06
```

</details>

---

## 📝 演習5: read_csv のオプションを使う

### 問題

以下のような特殊な CSV ファイルを想定し、適切なオプションを使って読み込んでください。

**ケース1**: ヘッダーがない CSV

まず、ヘッダーなしの CSV を作成：
```python
# ヘッダーなし CSV を作成
df = pd.DataFrame([[100, 200], [300, 400], [500, 600]])
df.to_csv("no_header.csv", header=False, index=False)
```

この CSV を読み込んで、カラム名を「列A」「列B」にしてください。

**ケース2**: 先頭行をスキップしたい CSV

まず、余計な行がある CSV を作成：
```python
# 先頭に余計な行がある CSV を作成
with open("with_comment.csv", "w") as f:
    f.write("# このファイルは売上データです\n")
    f.write("# 作成日: 2024-01-01\n")
    f.write("商品,価格\n")
    f.write("A,100\n")
    f.write("B,200\n")
```

この CSV を読み込んでください（先頭2行をスキップ）。

<details>
<summary>解答例を見る</summary>

```python
import pandas as pd

# ==========================================
# ケース1: ヘッダーがない CSV
# ==========================================

# ヘッダーなし CSV を作成
df = pd.DataFrame([[100, 200], [300, 400], [500, 600]])
df.to_csv("no_header.csv", header=False, index=False)

print("=== no_header.csv の中身 ===")
with open("no_header.csv", "r") as f:
    print(f.read())

# ヘッダーなしで読み込み、カラム名を設定
df_no_header = pd.read_csv("no_header.csv", header=None, names=["列A", "列B"])

print("=== 読み込み結果（カラム名設定後）===")
print(df_no_header)
print()

# ==========================================
# ケース2: 先頭行をスキップしたい CSV
# ==========================================

# 先頭に余計な行がある CSV を作成
with open("with_comment.csv", "w") as f:
    f.write("# このファイルは売上データです\n")
    f.write("# 作成日: 2024-01-01\n")
    f.write("商品,価格\n")
    f.write("A,100\n")
    f.write("B,200\n")

print("=== with_comment.csv の中身 ===")
with open("with_comment.csv", "r") as f:
    print(f.read())

# 先頭2行をスキップして読み込み
df_skip = pd.read_csv("with_comment.csv", skiprows=2)

print("=== 読み込み結果（先頭2行スキップ後）===")
print(df_skip)
print()

# 別解: comment オプションを使う（# で始まる行を無視）
df_comment = pd.read_csv("with_comment.csv", comment="#")

print("=== 読み込み結果（comment='#' 使用）===")
print(df_comment)
```

**実行結果:**
```
=== no_header.csv の中身 ===
100,200
300,400
500,600

=== 読み込み結果（カラム名設定後）===
    列A   列B
0  100  200
1  300  400
2  500  600

=== with_comment.csv の中身 ===
# このファイルは売上データです
# 作成日: 2024-01-01
商品,価格
A,100
B,200

=== 読み込み結果（先頭2行スキップ後）===
  商品   価格
0    A  100
1    B  200

=== 読み込み結果（comment='#' 使用）===
  商品   価格
0    A  100
1    B  200
```

</details>

---

## 🎯 チェックリスト

以下ができるようになったか確認しましょう：

- [ ] `pd.read_csv()` で CSV ファイルを読み込める
- [ ] `pd.read_excel()` で Excel ファイルを読み込める
- [ ] `to_csv()` で CSV ファイルに保存できる（index=False を理解）
- [ ] `to_excel()` で Excel ファイルに保存できる
- [ ] `ExcelWriter` で複数シートに保存できる
- [ ] `head()`, `tail()`, `shape`, `info()` でデータを確認できる
- [ ] `skiprows`, `header`, `names` などのオプションを使える
